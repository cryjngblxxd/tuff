-- Variables 
    -- Services
    local InputService, HttpService, GuiService, RunService, Stats, CoreGui, TweenService, SoundService, Workspace, Players = game:GetService("UserInputService"), game:GetService("HttpService"), game:GetService("GuiService"), game:GetService("RunService"), game:GetService("Stats"), game:GetService("CoreGui"), game:GetService("TweenService"), game:GetService("SoundService"), game:GetService("Workspace"), game:GetService("Players")
    local Camera, lp, gui_offset = Workspace.CurrentCamera, Players.LocalPlayer, GuiService:GetGuiInset().Y
    local mouse = lp:GetMouse()

    -- Data types
    local vec2, vec3, dim2, dim, rect, dim_offset = Vector2.new, Vector3.new, UDim2.new, UDim.new, Rect.new, UDim2.fromOffset

    -- Extra data types
    local color, rgb, hex, hsv, rgbseq, rgbkey, numseq, numkey = Color3.new, Color3.fromRGB, Color3.fromHex, Color3.fromHSV, ColorSequence.new, ColorSequenceKeypoint.new, NumberSequence.new, NumberSequenceKeypoint.new
-- 

-- Library init
    getgenv().Library = {
        Directory = "Nebula Premium",
        Folders = {
            "/fonts",
            "/configs",
        },
        Flags = {},
        ConfigFlags = {},
        Connections = {},   
        Notifications = {Notifs = {}},
        OpenElement = nil,
        EasingStyle = Enum.EasingStyle.Quint,
        TweeningSpeed = 0.25,
        MenuOpen = true,
        Initialized = false
    }
    
    local themes = {
        preset = {
            -- Main colors (Purple/Dark theme)
            inline = rgb(42, 42, 47),
            gradient = rgb(32, 32, 37),
            outline = rgb(15, 15, 18),
            accent = rgb(138, 43, 226),
            background = rgb(22, 22, 26),
            text_color = rgb(235, 235, 235),
            text_outline = rgb(0, 0, 0),
            tab_background = rgb(20, 20, 24),
            
            -- Enhanced CSGO-style colors
            border_dark = rgb(10, 10, 12),
            border_light = rgb(52, 52, 58),
            shadow = rgb(5, 5, 8),
            highlight = rgb(62, 62, 68),
            accent_dark = rgb(98, 28, 160),
            accent_light = rgb(165, 75, 250),
            glow = rgb(138, 43, 226),
        },
        utility = {},
        gradients = {
            Selected = {},
            Deselected = {},
        },
    }

    for theme, themeColor in pairs(themes.preset) do 
        themes.utility[theme] = {
            BackgroundColor3 = {},
            TextColor3 = {},
            ImageColor3 = {},
            ScrollBarImageColor3 = {},
            Color = {},
        }
    end 

    local Keys = {
        [Enum.KeyCode.LeftShift] = "LS",
        [Enum.KeyCode.RightShift] = "RS",
        [Enum.KeyCode.LeftControl] = "LC",
        [Enum.KeyCode.RightControl] = "RC",
        [Enum.KeyCode.Insert] = "INS",
        [Enum.KeyCode.Backspace] = "BS",
        [Enum.KeyCode.Return] = "Ent",
        [Enum.KeyCode.LeftAlt] = "LA",
        [Enum.KeyCode.RightAlt] = "RA",
        [Enum.KeyCode.CapsLock] = "CAPS",
        [Enum.KeyCode.One] = "1",
        [Enum.KeyCode.Two] = "2",
        [Enum.KeyCode.Three] = "3",
        [Enum.KeyCode.Four] = "4",
        [Enum.KeyCode.Five] = "5",
        [Enum.KeyCode.Six] = "6",
        [Enum.KeyCode.Seven] = "7",
        [Enum.KeyCode.Eight] = "8",
        [Enum.KeyCode.Nine] = "9",
        [Enum.KeyCode.Zero] = "0",
        [Enum.KeyCode.KeypadOne] = "Num1",
        [Enum.KeyCode.KeypadTwo] = "Num2",
        [Enum.KeyCode.KeypadThree] = "Num3",
        [Enum.KeyCode.KeypadFour] = "Num4",
        [Enum.KeyCode.KeypadFive] = "Num5",
        [Enum.KeyCode.KeypadSix] = "Num6",
        [Enum.KeyCode.KeypadSeven] = "Num7",
        [Enum.KeyCode.KeypadEight] = "Num8",
        [Enum.KeyCode.KeypadNine] = "Num9",
        [Enum.KeyCode.KeypadZero] = "Num0",
        [Enum.KeyCode.Minus] = "-",
        [Enum.KeyCode.Equals] = "=",
        [Enum.KeyCode.Tilde] = "~",
        [Enum.KeyCode.LeftBracket] = "[",
        [Enum.KeyCode.RightBracket] = "]",
        [Enum.KeyCode.RightParenthesis] = ")",
        [Enum.KeyCode.LeftParenthesis] = "(",
        [Enum.KeyCode.Semicolon] = ";",
        [Enum.KeyCode.Quote] = "'",
        [Enum.KeyCode.BackSlash] = "\\",
        [Enum.KeyCode.Comma] = ",",
        [Enum.KeyCode.Period] = ".",
        [Enum.KeyCode.Slash] = "/",
        [Enum.KeyCode.Asterisk] = "*",
        [Enum.KeyCode.Plus] = "+",
        [Enum.KeyCode.Backquote] = "`",
        [Enum.UserInputType.MouseButton1] = "MB1",
        [Enum.UserInputType.MouseButton2] = "MB2",
        [Enum.UserInputType.MouseButton3] = "MB3",
        [Enum.KeyCode.Escape] = "ESC",
        [Enum.KeyCode.Space] = "SPC",
    }
        
    Library.__index = Library

    for _, path in ipairs(Library.Folders) do 
        pcall(function()
            makefolder(Library.Directory .. path)
        end)
    end

    local Flags = Library.Flags 
    local ConfigFlags = Library.ConfigFlags
    local Notifications = Library.Notifications 
    local ConfigHolder

    -- Font registration
    local Fonts = {}
    do
        local function RegisterFont(Name, Weight, Style, Asset)
            pcall(function()
                if not isfile(Asset.Id) then
                    writefile(Asset.Id, Asset.Font)
                end

                if isfile(Name .. ".font") then
                    delfile(Name .. ".font")
                end

                local Data = {
                    name = Name,
                    faces = {
                        {
                            name = "Normal",
                            weight = Weight,
                            style = Style,
                            assetId = getcustomasset(Asset.Id),
                        },
                    },
                }

                writefile(Name .. ".font", HttpService:JSONEncode(Data))
            end)

            local success, result = pcall(function()
                return getcustomasset(Name .. ".font")
            end)
            
            return success and result or nil
        end
        
        local FontAsset = RegisterFont("NebulaPremiumFont", 400, "Normal", {
            Id = "NebulaPremiumFont.ttf",
            Font = game:HttpGet("https://github.com/i77lhm/storage/raw/refs/heads/main/fonts/fs-tahoma-8px.ttf"),
        })

        if FontAsset then
            Library.Font = Font.new(FontAsset, Enum.FontWeight.Regular, Enum.FontStyle.Normal)
        else
            Library.Font = Font.fromEnum(Enum.Font.Gotham)
        end
    end
--

-- Library functions 
    -- Misc functions
        function Library:GetTransparency(obj)
            if not obj then return nil end
            
            local success, isGuiObject = pcall(function()
                return obj:IsA("GuiObject") or obj:IsA("UIStroke")
            end)
            
            if not success or not isGuiObject then return nil end
            
            if obj:IsA("Frame") then
                return {"BackgroundTransparency"}
            elseif obj:IsA("TextLabel") or obj:IsA("TextButton") then
                return {"TextTransparency", "BackgroundTransparency"}
            elseif obj:IsA("ImageLabel") or obj:IsA("ImageButton") then
                return {"BackgroundTransparency", "ImageTransparency"}
            elseif obj:IsA("ScrollingFrame") then
                return {"BackgroundTransparency", "ScrollBarImageTransparency"}
            elseif obj:IsA("TextBox") then
                return {"TextTransparency", "BackgroundTransparency"}
            elseif obj:IsA("UIStroke") then 
                return {"Transparency"}
            end
            
            return nil
        end

        function Library:Tween(Object, Properties, Info)
            if not Object then return nil end
            
            local tween = TweenService:Create(
                Object, 
                Info or TweenInfo.new(Library.TweeningSpeed, Library.EasingStyle, Enum.EasingDirection.InOut, 0, false, 0), 
                Properties
            )
            tween:Play()
            
            return tween
        end

        function Library:Fade(obj, prop, vis, speed)
            if not (obj and prop) then
                return nil
            end

            local success, OldTransparency = pcall(function()
                return obj[prop]
            end)
            
            if not success then return nil end

            obj[prop] = vis and 1 or OldTransparency

            local Tween = Library:Tween(
                obj, 
                {[prop] = vis and OldTransparency or 1}, 
                TweenInfo.new(speed or Library.TweeningSpeed, Library.EasingStyle, Enum.EasingDirection.InOut, 0, false, 0)
            )

            if Tween then
                Library:Connection(Tween.Completed, function()
                    if not vis then
                        task.wait()
                        pcall(function()
                            obj[prop] = OldTransparency
                        end)
                    end
                end)
            end

            return Tween
        end

        function Library:Resizify(Parent)
            local Resizing = Library:Create("TextButton", {
                Position = dim2(1, -12, 1, -12),
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 12, 0, 12),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255),
                Parent = Parent,
                BackgroundTransparency = 1,
                Text = "",
                ZIndex = 100
            })
            
            local ResizeIndicator = Library:Create("Frame", {
                Parent = Resizing,
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 1, 0),
            })
            
            -- Create resize corner lines
            for i = 1, 3 do
                Library:Create("Frame", {
                    Parent = ResizeIndicator,
                    BackgroundColor3 = themes.preset.text_color,
                    BackgroundTransparency = 0.5,
                    BorderSizePixel = 0,
                    Position = dim2(1, -3 - (i * 3), 1, -1),
                    Size = dim2(0, 1 + (i * 3), 0, 1),
                    Rotation = -45
                })
            end
        
            local IsResizing = false 
            local Size 
            local InputLost 
            local ParentSize = Parent.Size  
            
            Resizing.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsResizing = true
                    InputLost = input.Position
                    Size = Parent.Size
                end
            end)
        
            Resizing.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsResizing = false
                end
            end)
        
            Library:Connection(InputService.InputChanged, function(input, game_event) 
                if IsResizing and input.UserInputType == Enum.UserInputType.MouseMovement then            
                    Parent.Size = dim2(
                        Size.X.Scale,
                        math.clamp(Size.X.Offset + (input.Position.X - InputLost.X), ParentSize.X.Offset, Camera.ViewportSize.X), 
                        Size.Y.Scale, 
                        math.clamp(Size.Y.Offset + (input.Position.Y - InputLost.Y), ParentSize.Y.Offset, Camera.ViewportSize.Y)
                    )
                end
            end)
        end
        
        function Library:Hovering(Object)
            if not Object then return false end
            
            if type(Object) == "table" then 
                for _, obj in ipairs(Object) do 
                    if obj and Library:Hovering(obj) then 
                        return true
                    end 
                end
                return false
            else 
                local success, result = pcall(function()
                    local y_cond = Object.AbsolutePosition.Y <= mouse.Y and mouse.Y <= Object.AbsolutePosition.Y + Object.AbsoluteSize.Y
                    local x_cond = Object.AbsolutePosition.X <= mouse.X and mouse.X <= Object.AbsolutePosition.X + Object.AbsoluteSize.X
                    return (y_cond and x_cond)
                end)
                
                return success and result or false
            end 
        end  

        function Library:Draggify(Parent)
            local Dragging = false 
            local InitialSize = Parent.Position
            local InitialPosition 

            Parent.InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = true
                    InitialPosition = Input.Position
                    InitialSize = Parent.Position
                end
            end)

            Parent.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = false
                end
            end)

            Library:Connection(InputService.InputChanged, function(Input, game_event) 
                if Dragging and Input.UserInputType == Enum.UserInputType.MouseMovement then
                    local Horizontal = Camera.ViewportSize.X
                    local Vertical = Camera.ViewportSize.Y

                    local NewPosition = dim2(
                        0,
                        math.clamp(
                            InitialSize.X.Offset + (Input.Position.X - InitialPosition.X),
                            0,
                            Horizontal - Parent.Size.X.Offset
                        ),
                        0,
                        math.clamp(
                            InitialSize.Y.Offset + (Input.Position.Y - InitialPosition.Y),
                            0,
                            Vertical - Parent.Size.Y.Offset
                        )
                    )

                    Parent.Position = NewPosition
                end
            end)
        end 

        function Library:Convert(str)
            local Values = {}

            for Value in string.gmatch(str, "[^,]+") do
                local num = tonumber(Value:match("^%s*(.-)%s*$"))
                if num then
                    table.insert(Values, num)
                end
            end

            if #Values == 4 then              
                return unpack(Values)
            elseif #Values == 3 then
                return Values[1], Values[2], Values[3], 1
            else
                return nil
            end
        end
        
        function Library:Lerp(start, finish, t)
            t = t or 1 / 8
            return start * (1 - t) + finish * t
        end

        function Library:ConvertEnum(enum)
            if type(enum) ~= "string" then return enum end
            
            local EnumParts = {}
            
            for part in string.gmatch(enum, "[%w_]+") do
                table.insert(EnumParts, part)
            end
        
            local EnumTable = Enum

            for i = 2, #EnumParts do
                local success, EnumItem = pcall(function()
                    return EnumTable[EnumParts[i]]
                end)
                
                if success then
                    EnumTable = EnumItem
                else
                    return nil
                end
            end
            
            return EnumTable
        end

        function Library:ConvertHex(color, alpha)
            local r = math.floor(color.R * 255)
            local g = math.floor(color.G * 255)
            local b = math.floor(color.B * 255)
            local a = alpha and math.floor(alpha * 255) or 255
            return string.format("#%02X%02X%02X%02X", r, g, b, a)
        end

        function Library:ConvertFromHex(hexColor)
            hexColor = hexColor:gsub("#", "")
            
            local r = tonumber(hexColor:sub(1, 2), 16)
            local g = tonumber(hexColor:sub(3, 4), 16)
            local b = tonumber(hexColor:sub(5, 6), 16)
            local a = #hexColor >= 8 and tonumber(hexColor:sub(7, 8), 16) or 255
            
            if r and g and b then
                return Color3.new(r / 255, g / 255, b / 255), a / 255
            end
            
            return Color3.new(1, 1, 1), 1
        end

        function Library:UpdateConfigList() 
            if not ConfigHolder then 
                return 
            end
            
            local List = {}
            
            pcall(function()
                for _, file in ipairs(listfiles(Library.Directory .. "/configs")) do
                    local Name = file:gsub(Library.Directory .. "/configs\\", ""):gsub(".cfg", ""):gsub(Library.Directory .. "/configs/", "")
                    if Name ~= "" then
                        List[#List + 1] = Name
                    end
                end
            end)

            ConfigHolder.RefreshOptions(List)
        end

        function Library:Keypicker(properties) 
            local Cfg = {
                Name = properties.Name or "Color", 
                Flag = properties.Flag or properties.Name or "Colorpicker",
                Callback = properties.Callback or function() end,
                Color = properties.Color or color(1, 1, 1),
                Alpha = properties.Alpha or properties.Transparency or 0,
                Mode = properties.Mode or "Keypicker",
                Open = false, 
                Items = {},
            }

            local DraggingSat = false 
            local DraggingHue = false 
            local DraggingAlpha = false 

            local h, s, v = Cfg.Color:ToHSV() 
            local a = Cfg.Alpha 

            Flags[Cfg.Flag] = {Color = Cfg.Color, Transparency = Cfg.Alpha}

            local Items = Cfg.Items
            
            -- Colorpicker button component
            Items.ColorpickerObject = Library:Create("TextButton", {
                Name = "\0",
                Text = "",
                AutoButtonColor = false,
                Parent = self.Items.Components,
                BorderSizePixel = 0,
                Size = dim2(0, 26, 0, 12),
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.ColorpickerObject, "border_dark", "BackgroundColor3")
            
            Items.ColorpickerInline = Library:Create("Frame", {
                Parent = Items.ColorpickerObject,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.ColorpickerInline, "inline", "BackgroundColor3")
            
            Items.InlineColorPicker = Library:Create("Frame", {
                Parent = Items.ColorpickerInline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIGradient", {
                Color = rgbseq{rgbkey(0, rgb(180, 180, 180)), rgbkey(1, rgb(255, 255, 255))},
                Rotation = 90,
                Parent = Items.InlineColorPicker
            })
            
            Items.Inner = Library:Create("Frame", {
                Parent = Items.InlineColorPicker,
                Name = "\0",
                Position = dim2(0, 0, 0, 0),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 1, 0),
                BackgroundColor3 = rgb(255, 255, 255),
                BackgroundTransparency = 0.15
            })

            -- Main Colorpicker popup
            Items.Colorpicker = Library:Create("TextButton", {
                Parent = Library.Other,
                Text = "",
                AutoButtonColor = false,
                Name = "\0",
                Visible = false,
                BorderSizePixel = 0,
                Size = dim2(0, 220, 0, 220),
                BackgroundColor3 = themes.preset.border_dark,
                ZIndex = 50
            })
            Library:Themify(Items.Colorpicker, "border_dark", "BackgroundColor3")
            
            Items.ColorpickerOuterBorder = Library:Create("UIStroke", {
                Color = themes.preset.shadow,
                LineJoinMode = Enum.LineJoinMode.Miter,
                Parent = Items.Colorpicker,
                Thickness = 1,
                ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
            })
            Library:Themify(Items.ColorpickerOuterBorder, "shadow", "Color")

            Items.Fade = Library:Create("Frame", {
                BorderSizePixel = 0,
                Parent = Items.Colorpicker,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 1, 0, 25),
                Size = dim2(1, -2, 1, -26),
                ZIndex = 100,
                BackgroundColor3 = themes.preset.gradient
            })
            Library:Themify(Items.Fade, "gradient", "BackgroundColor3")
            
            Items.ColorTab = Library:Create("Frame", {
                Parent = Items.Colorpicker,
                Name = "\0",
                Position = dim2(0, 1, 0, 25),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -26),
                BackgroundColor3 = themes.preset.gradient,
                ZIndex = 51
            })
            Library:Themify(Items.ColorTab, "gradient", "BackgroundColor3")
            
            Library:Create("UIPadding", {
                PaddingTop = dim(0, 4),
                PaddingBottom = dim(0, 4),
                Parent = Items.ColorTab,
                PaddingRight = dim(0, 4),
                PaddingLeft = dim(0, 4)
            })
            
            -- Saturation/Value holder
            Items.SatValHolder = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.ColorTab,
                BorderSizePixel = 0,
                Size = dim2(1, -40, 1, -44),
                BackgroundColor3 = themes.preset.border_dark,
                ZIndex = 52
            })
            Library:Themify(Items.SatValHolder, "border_dark", "BackgroundColor3")
            
            Items.SatValInline = Library:Create("Frame", {
                Parent = Items.SatValHolder,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline,
                ZIndex = 52
            })
            Library:Themify(Items.SatValInline, "inline", "BackgroundColor3")
            
            Items.Color = Library:Create("Frame", {
                Parent = Items.SatValInline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 0, 0),
                ZIndex = 52
            })
            
            Items.SaturationOverlay = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.Color,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 1, 0),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 53
            })
            
            Library:Create("UIGradient", {
                Parent = Items.SaturationOverlay,
                Transparency = numseq{numkey(0, 0), numkey(1, 1)}
            })
            
            Items.ValueOverlay = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.Color,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 1, 0),
                BackgroundColor3 = rgb(0, 0, 0),
                ZIndex = 54
            })
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.ValueOverlay,
                Transparency = numseq{numkey(0, 1), numkey(1, 0)}
            })
            
            Items.SatValPicker = Library:Create("Frame", {
                Name = "\0",
                AnchorPoint = vec2(0.5, 0.5),
                Parent = Items.Color,
                BorderColor3 = rgb(0, 0, 0),
                Size = dim2(0, 6, 0, 6),
                BorderSizePixel = 1,
                ZIndex = 56,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UICorner", {
                Parent = Items.SatValPicker,
                CornerRadius = dim(1, 0)
            })
            
            Items.Sat = Library:Create("TextButton", {
                Parent = Items.Color,
                Name = "\0",
                Text = "",
                AutoButtonColor = false,
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                ZIndex = 55,
                BackgroundTransparency = 1,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            -- RGB Input Frame
            Items.RGBTextBox = Library:Create("Frame", {
                AnchorPoint = vec2(0, 1),
                Parent = Items.ColorTab,
                Name = "\0",
                Position = dim2(0, 0, 1, -22),
                BorderSizePixel = 0,
                Size = dim2(1, -40, 0, 20),
                BackgroundColor3 = themes.preset.border_dark,
                ZIndex = 52
            })
            Library:Themify(Items.RGBTextBox, "border_dark", "BackgroundColor3")
            
            Items.RGBInline = Library:Create("Frame", {
                Parent = Items.RGBTextBox,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline,
                ZIndex = 52
            })
            Library:Themify(Items.RGBInline, "inline", "BackgroundColor3")
            
            Items.RGBBackground = Library:Create("Frame", {
                Parent = Items.RGBInline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 52
            })
            
            local rgbGradient = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.RGBBackground,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(rgbGradient, "Selected")
            
            Items.RGBInput = Library:Create("TextBox", {
                CursorPosition = -1,
                Parent = Items.RGBBackground,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = "255, 255, 255, 1",
                Name = "\0",
                ClearTextOnFocus = false,
                Size = dim2(1, -4, 1, 0),
                Position = dim2(0, 2, 0, 0),
                TextXAlignment = Enum.TextXAlignment.Left,
                BackgroundTransparency = 1,
                PlaceholderColor3 = themes.preset.text_color,
                FontFace = Library.Font,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 53
            })
            
            Library:Create("UIStroke", {
                Parent = Items.RGBInput,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Hex Input Frame
            Items.AlphaInputFrame = Library:Create("Frame", {
                AnchorPoint = vec2(0, 1),
                Parent = Items.ColorTab,
                Name = "\0",
                Position = dim2(0, 0, 1, 0),
                BorderSizePixel = 0,
                Size = dim2(1, -40, 0, 20),
                BackgroundColor3 = themes.preset.border_dark,
                ZIndex = 52
            })
            Library:Themify(Items.AlphaInputFrame, "border_dark", "BackgroundColor3")
            
            Items.AlphaInline = Library:Create("Frame", {
                Parent = Items.AlphaInputFrame,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline,
                ZIndex = 52
            })
            Library:Themify(Items.AlphaInline, "inline", "BackgroundColor3")
            
            Items.AlphaBackground = Library:Create("Frame", {
                Parent = Items.AlphaInline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 52
            })
            
            local alphaGradient = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.AlphaBackground,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(alphaGradient, "Selected")
            
            Items.InputAlpha = Library:Create("TextBox", {
                CursorPosition = -1,
                Parent = Items.AlphaBackground,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = "#FFFFFF",
                Name = "\0",
                ClearTextOnFocus = false,
                Size = dim2(1, -4, 1, 0),
                Position = dim2(0, 2, 0, 0),
                TextXAlignment = Enum.TextXAlignment.Left,
                BackgroundTransparency = 1,
                PlaceholderColor3 = themes.preset.text_color,
                FontFace = Library.Font,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 53
            })
            
            Library:Create("UIStroke", {
                Parent = Items.InputAlpha,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Alpha Slider
            Items.AlphaSlider = Library:Create("TextButton", {
                AnchorPoint = vec2(1, 1),
                Parent = Items.ColorTab,
                Name = "\0",
                AutoButtonColor = false,
                Text = "",
                Position = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                Size = dim2(0, 18, 1, 0),
                BackgroundColor3 = themes.preset.border_dark,
                ZIndex = 52
            })
            Library:Themify(Items.AlphaSlider, "border_dark", "BackgroundColor3")
            
            Items.AlphaSliderInline = Library:Create("Frame", {
                Parent = Items.AlphaSlider,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline,
                ZIndex = 52
            })
            Library:Themify(Items.AlphaSliderInline, "inline", "BackgroundColor3")
            
            Items.AlphaSliderBackground = Library:Create("Frame", {
                Parent = Items.AlphaSliderInline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 52
            })
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.AlphaSliderBackground,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(0, 0, 0))}
            })
            
            Items.AlphaPicker = Library:Create("Frame", {
                Parent = Items.AlphaSliderBackground,
                Name = "\0",
                BorderColor3 = rgb(0, 0, 0),
                BorderMode = Enum.BorderMode.Inset,
                Size = dim2(1, 2, 0, 3),
                Position = dim2(0, -1, 0, 0),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 53
            })

            -- Hue Slider
            Items.HueSlider = Library:Create("TextButton", {
                AnchorPoint = vec2(1, 1),
                Parent = Items.ColorTab,
                Text = "",
                AutoButtonColor = false,
                Name = "\0",
                Position = dim2(1, -20, 1, 0),
                BorderSizePixel = 0,
                Size = dim2(0, 18, 1, 0),
                BackgroundColor3 = themes.preset.border_dark,
                ZIndex = 52
            })
            Library:Themify(Items.HueSlider, "border_dark", "BackgroundColor3")
            
            Items.HueSliderInline = Library:Create("Frame", {
                Parent = Items.HueSlider,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline,
                ZIndex = 52
            })
            Library:Themify(Items.HueSliderInline, "inline", "BackgroundColor3")
            
            Items.HueDrag = Library:Create("Frame", {
                Parent = Items.HueSliderInline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 52
            })
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.HueDrag,
                Color = rgbseq{
                    rgbkey(0, rgb(255, 0, 0)), 
                    rgbkey(0.17, rgb(255, 255, 0)), 
                    rgbkey(0.33, rgb(0, 255, 0)), 
                    rgbkey(0.5, rgb(0, 255, 255)), 
                    rgbkey(0.67, rgb(0, 0, 255)), 
                    rgbkey(0.83, rgb(255, 0, 255)), 
                    rgbkey(1, rgb(255, 0, 0))
                }
            })
            
            Items.HuePicker = Library:Create("Frame", {
                Parent = Items.HueDrag,
                Name = "\0",
                BorderColor3 = rgb(0, 0, 0),
                BorderMode = Enum.BorderMode.Inset,
                Size = dim2(1, 2, 0, 3),
                Position = dim2(0, -1, 0, 0),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 53
            })

            -- Tab Buttons Header
            Items.TabButtons = Library:Create("Frame", {
                Parent = Items.Colorpicker,
                Name = "\0",
                Position = dim2(0, 0, 0, 0),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 25),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 51
            })
            
            Items.TabAccent = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.TabButtons,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 2),
                BackgroundColor3 = themes.preset.accent,
                ZIndex = 52
            })
            Library:Themify(Items.TabAccent, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TabAccent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(158, 158, 158))}
            })
            
            Items.TabOutline = Library:Create("Frame", {
                Parent = Items.TabButtons,
                Name = "\0",
                Position = dim2(0, 0, 0, 2),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 1),
                BackgroundColor3 = themes.preset.outline,
                ZIndex = 52
            })
            Library:Themify(Items.TabOutline, "outline", "BackgroundColor3")

            local tabButtonsGradient = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TabButtons,
                Color = rgbseq{rgbkey(0, themes.preset.gradient), rgbkey(1, themes.preset.background)}
            })
            Library:SaveGradient(tabButtonsGradient, "Deselected")
            
            Items.Buttons = Library:Create("Frame", {
                Parent = Items.TabButtons,
                BackgroundTransparency = 1,
                Name = "\0",
                BorderSizePixel = 0,
                Size = dim2(1, 0, 1, -1),
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 52
            })
            
            Library:Create("UIListLayout", {
                Parent = Items.Buttons,
                FillDirection = Enum.FillDirection.Horizontal,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = dim(0, -1),
            })
            
            Library:Create("UIPadding", {
                Parent = Items.Buttons,
                PaddingTop = dim(0, 3)
            })
            
            Items.BottomOutline = Library:Create("Frame", {
                BorderSizePixel = 0,
                AnchorPoint = vec2(0, 1),
                Parent = Items.TabButtons,
                Name = "\0",
                Position = dim2(0, 0, 1, 0),
                Size = dim2(1, 0, 0, 1),
                ZIndex = 53,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.BottomOutline, "outline", "BackgroundColor3")

            -- Animation Tab (if Mode is Animation)
            if Cfg.Mode == "Animation" then 
                Items.AnimationTab = Library:Create("Frame", {
                    Visible = false,
                    Parent = Items.Colorpicker,
                    Name = "\0",
                    Position = dim2(0, 1, 0, 25),
                    BorderSizePixel = 0,
                    Size = dim2(1, -2, 1, -26),
                    BackgroundColor3 = themes.preset.gradient,
                    ZIndex = 51
                })
                Library:Themify(Items.AnimationTab, "gradient", "BackgroundColor3")
                
                Library:Create("UIPadding", {
                    PaddingTop = dim(0, 4),
                    PaddingBottom = dim(0, 4),
                    Parent = Items.AnimationTab,
                    PaddingRight = dim(0, 4),
                    PaddingLeft = dim(0, 4)
                })
                
                Items.AnimationElements = Library:Create("Frame", {
                    BorderSizePixel = 0,
                    Parent = Items.AnimationTab,
                    Name = "\0",
                    BackgroundTransparency = 1,
                    Position = dim2(0, 2, 0, 0),
                    Size = dim2(1, -4, 0, 0),
                    AutomaticSize = Enum.AutomaticSize.Y,
                    BackgroundColor3 = rgb(255, 255, 255),
                    ZIndex = 52
                })
                
                Library:Create("UIListLayout", {
                    Parent = Items.AnimationElements,
                    Padding = dim(0, 4),
                    SortOrder = Enum.SortOrder.LayoutOrder
                })
                
                Library:Create("UIPadding", {
                    PaddingBottom = dim(0, 6),
                    Parent = Items.AnimationElements
                })

                task.spawn(function()
                    while true do 
                        task.wait() 
                        local Type = Flags[Cfg.Flag .. "_ANIMATION_TYPE"]
                        local FlashSpeed = (100 - (Flags[Cfg.Flag .. "_ANIMATION_SPEED"] or 50)) / 25
                        if Type and Type ~= "None" then 
                            local Speed = math.abs(math.sin(tick() * ((Flags[Cfg.Flag .. "_ANIMATION_SPEED"] or 50) / 25)))
                            if Type == "Rainbow" then 
                                Cfg.Set(hsv(Speed, s, v), a)
                            elseif Type == "Fading" then 
                                local PrimaryColor = Flags[Cfg.Flag .. "_PRIMARY_COLOR"]
                                local SecondaryColor = Flags[Cfg.Flag .. "_SECONDARY_COLOR"]
                                if PrimaryColor and SecondaryColor and PrimaryColor.Color and SecondaryColor.Color then
                                    local LerpedColor = PrimaryColor.Color:Lerp(SecondaryColor.Color, Speed)
                                    Cfg.Set(LerpedColor, Library:Lerp(PrimaryColor.Transparency or 0, SecondaryColor.Transparency or 0, Speed))
                                end
                            elseif Type == "Flashing" then 
                                local PrimaryColor = Flags[Cfg.Flag .. "_PRIMARY_COLOR"]
                                local SecondaryColor = Flags[Cfg.Flag .. "_SECONDARY_COLOR"]
                                if PrimaryColor and SecondaryColor and PrimaryColor.Color and SecondaryColor.Color then
                                    Cfg.Set(PrimaryColor.Color, PrimaryColor.Transparency or 0)
                                    task.wait(FlashSpeed)
                                    Cfg.Set(SecondaryColor.Color, SecondaryColor.Transparency or 0)
                                    task.wait(FlashSpeed)
                                end
                            end 
                        end 
                    end 
                end)
            end

            -- Create Tab Buttons
            local TabsList = {}
            local OldTab

            if Cfg.Mode == "Animation" then 
                TabsList = {"ColorTab", "AnimationTab"}
            else 
                TabsList = {"ColorTab"}
            end 

            for idx, tab in ipairs(TabsList) do
                local Temp = {}

                Temp.Button = Library:Create("TextButton", {
                    Parent = Items.Buttons,
                    Name = "\0",
                    Size = dim2(0, 0, 1, 0),
                    BorderSizePixel = 0,
                    Text = "",
                    AutomaticSize = Enum.AutomaticSize.X,
                    AutoButtonColor = false,
                    BackgroundColor3 = rgb(255, 255, 255),
                    ZIndex = 53
                })
                
                Temp.Background = Library:Create("TextLabel", {
                    FontFace = Library.Font,
                    TextColor3 = themes.preset.text_color,
                    BorderSizePixel = 0,
                    Text = tab:gsub("Tab", ""),
                    Parent = Temp.Button,
                    Name = "\0",
                    BackgroundTransparency = idx == 1 and 1 or 0,
                    Size = dim2(0, 0, 1, 0),
                    AutomaticSize = Enum.AutomaticSize.XY,
                    TextSize = 12,
                    BackgroundColor3 = themes.preset.tab_background,
                    ZIndex = 53
                })
                Library:Themify(Temp.Background, "tab_background", "BackgroundColor3")
                
                Temp.TextPadding = Library:Create("UIPadding", {
                    Parent = Temp.Background,
                    PaddingRight = dim(0, 8),
                    PaddingLeft = dim(0, 6)
                })
                
                Library:Create("UIStroke", {
                    Parent = Temp.Background,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })
                
                Temp.Fill = Library:Create("Frame", {
                    BorderSizePixel = 0,
                    AnchorPoint = vec2(0, 1),
                    Parent = Temp.Button,
                    Name = "\0",
                    Position = dim2(0, 0, 1, 1),
                    Size = dim2(1, 0, 0, 1),
                    ZIndex = 54,
                    BackgroundTransparency = idx == 1 and 0 or 1,
                    BackgroundColor3 = themes.preset.gradient
                })
                Library:Themify(Temp.Fill, "gradient", "BackgroundColor3")
                
                local buttonGradient = Library:Create("UIGradient", {
                    Rotation = 90,
                    Parent = Temp.Button,
                    Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
                })
                Library:SaveGradient(buttonGradient, "Selected")
                
                Temp.UIStroke = Library:Create("UIStroke", {
                    Color = themes.preset.outline,
                    LineJoinMode = Enum.LineJoinMode.Miter,
                    Parent = Temp.Button,
                    ApplyStrokeMode = Enum.ApplyStrokeMode.Border
                })
                Library:Themify(Temp.UIStroke, "outline", "Color")

                if idx == 1 then 
                    OldTab = Temp
                end 

                Temp.Button.MouseButton1Click:Connect(function()
                    for _, close in ipairs(TabsList) do 
                        if Items[close] then
                            Items[close].Visible = false
                        end
                    end 
                    
                    if OldTab then 
                        Library:Tween(OldTab.Fill, {BackgroundTransparency = 1})
                        Library:Tween(OldTab.Background, {BackgroundTransparency = 0})
                    end 

                    if Items[tab] then
                        Items[tab].Visible = true
                    end
                    Library:Tween(Temp.Fill, {BackgroundTransparency = 0})
                    Library:Tween(Temp.Background, {BackgroundTransparency = 1})

                    if Items.AnimationDropdown then 
                        Items.AnimationDropdown.SetVisible(false)
                        Items.AnimationDropdown.Open = false
                    end
                    
                    if Items.Primary then
                        Items.Primary.SetVisible(false)
                        Items.Primary.Open = false
                    end
                    
                    if Items.Secondary then
                        Items.Secondary.SetVisible(false)
                        Items.Secondary.Open = false
                    end

                    Items.Fade.BackgroundTransparency = 0 
                    Library:Tween(Items.Fade, {BackgroundTransparency = 1})

                    OldTab = Temp
                end)
            end

            -- Animation mode elements
            if Cfg.Mode == "Animation" then 
                local AnimIndex = setmetatable({Items = {Elements = Items.AnimationElements, Components = Items.AnimationElements}}, Library)
                Items.AnimationDropdown = AnimIndex:Dropdown({
                    Name = "Animation", 
                    Flag = Cfg.Flag .. "_ANIMATION_TYPE", 
                    Options = {"None", "Rainbow", "Fading", "Flashing"}, 
                    Default = "None"
                })
                Items.Primary = AnimIndex:Label({Name = "Primary"}):Keypicker({Mode = "Keypicker", Flag = Cfg.Flag .. "_PRIMARY_COLOR"})
                Items.Secondary = AnimIndex:Label({Name = "Secondary"}):Keypicker({Mode = "Keypicker", Flag = Cfg.Flag .. "_SECONDARY_COLOR"})
                AnimIndex:Slider({Name = "Speed", Min = 0, Max = 100, Decimal = 1, Suffix = "%", Flag = Cfg.Flag .. "_ANIMATION_SPEED", Default = 50})
                
                Library:Connection(InputService.InputBegan, function(input, game_event) 
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        if Items.Colorpicker.Visible and not Library:Hovering({
                                Items.ColorpickerObject, 
                                Items.AnimationDropdown and Items.AnimationDropdown.Items.DropdownElements or nil, 
                                Items.AnimationDropdown and Items.AnimationDropdown.Items.Dropdown or nil, 
                                Items.Colorpicker,
                                Items.Primary and Items.Primary.Items.Colorpicker or nil,
                                Items.Secondary and Items.Secondary.Items.Colorpicker or nil
                            }) then
                            if Items.AnimationDropdown then
                                Items.AnimationDropdown.SetVisible(false)
                                Items.AnimationDropdown.Open = false
                            end
                            
                            Cfg.Open = false
                            Cfg.SetVisible(false)
                            
                            if Items.Primary then
                                Items.Primary.SetVisible(false)
                                Items.Primary.Open = false
                            end

                            if Items.Secondary then
                                Items.Secondary.SetVisible(false)
                                Items.Secondary.Open = false
                            end
                        end 
                    end 
                end) 
                
                local Pickers = {Items.Primary, Items.Secondary}
                for _, picker in ipairs(Pickers) do
                    if picker then
                        Library:Connection(InputService.InputBegan, function(input, game_event)
                            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                                if picker.Items.Colorpicker.Visible and not Library:Hovering({picker.Items.ColorpickerObject, picker.Items.Colorpicker}) then
                                    picker.SetVisible(false)
                                    picker.Open = false
                                end 
                            end 
                        end)
                    end
                end
            end
            
            function Cfg.SetVisible(bool)
                Items.Fade.BackgroundTransparency = 0 
                Library:Tween(Items.Fade, {BackgroundTransparency = 1})

                Items.Colorpicker.Visible = bool
                Items.Colorpicker.Parent = bool and Library.Items or Library.Other
                
                if bool then
                    local xPos = Items.ColorpickerObject.AbsolutePosition.X
                    local yPos = Items.ColorpickerObject.AbsolutePosition.Y + 20
                    
                    -- Keep within screen bounds
                    if xPos + 220 > Camera.ViewportSize.X then
                        xPos = Camera.ViewportSize.X - 230
                    end
                    if yPos + 220 > Camera.ViewportSize.Y then
                        yPos = Items.ColorpickerObject.AbsolutePosition.Y - 225
                    end
                    
                    Items.Colorpicker.Position = dim2(0, xPos, 0, yPos)
                end
            end
            
            function Cfg.Set(newColor, alpha)
                if type(newColor) == "boolean" then 
                    return
                end 

                if newColor then 
                    h, s, v = newColor:ToHSV()
                end
                
                if alpha ~= nil then 
                    a = alpha
                end 
                
                local Color = hsv(h, s, v)

                Items.SatValPicker.Position = dim2(s, 0, 1 - v, 0)
                Items.AlphaPicker.Position = dim2(0, -1, a, -1)
                Items.HuePicker.Position = dim2(0, -1, h, -1)
                
                Items.Inner.BackgroundColor3 = Color
                Items.InlineColorPicker.BackgroundColor3 = Color
                Items.Color.BackgroundColor3 = hsv(h, 1, 1)

                Flags[Cfg.Flag] = {
                    Color = Color,
                    Transparency = a 
                }
                
                Items.RGBInput.Text = string.format("%d, %d, %d, %.2f", 
                    Library:Round(Color.R * 255), 
                    Library:Round(Color.G * 255), 
                    Library:Round(Color.B * 255),
                    Library:Round(1 - a, 0.01)
                )
                
                Items.InputAlpha.Text = Library:ConvertHex(Color, 1 - a)

                Cfg.Callback(Color, a)
            end

            function Cfg.UpdateColor() 
                local Mouse = InputService:GetMouseLocation()
                local offset = vec2(Mouse.X, Mouse.Y - gui_offset) 
                
                if DraggingSat then	
                    s = math.clamp((offset.X - Items.Sat.AbsolutePosition.X) / Items.Sat.AbsoluteSize.X, 0, 1)
                    v = 1 - math.clamp((offset.Y - Items.Sat.AbsolutePosition.Y) / Items.Sat.AbsoluteSize.Y, 0, 1)
                elseif DraggingHue then
                    h = math.clamp((offset.Y - Items.HueSlider.AbsolutePosition.Y) / Items.HueSlider.AbsoluteSize.Y, 0, 1)
                elseif DraggingAlpha then
                    a = math.clamp((offset.Y - Items.AlphaSlider.AbsolutePosition.Y) / Items.AlphaSlider.AbsoluteSize.Y, 0, 1)
                end

                Cfg.Set()
            end

            Items.ColorpickerObject.MouseButton1Click:Connect(function()
                Cfg.Open = not Cfg.Open
                Cfg.SetVisible(Cfg.Open)            
            end)

            Library:Connection(InputService.InputChanged, function(input)
                if (DraggingSat or DraggingHue or DraggingAlpha) and input.UserInputType == Enum.UserInputType.MouseMovement then
                    Cfg.UpdateColor() 
                end
            end)

            Library:Connection(InputService.InputEnded, function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    DraggingSat = false
                    DraggingHue = false
                    DraggingAlpha = false
                end
            end)    

            Items.AlphaSlider.MouseButton1Down:Connect(function()
                DraggingAlpha = true 
                Cfg.UpdateColor()
            end)
            
            Items.HueSlider.MouseButton1Down:Connect(function()
                DraggingHue = true 
                Cfg.UpdateColor()
            end)
            
            Items.Sat.MouseButton1Down:Connect(function()
                DraggingSat = true
                Cfg.UpdateColor()
            end)

            Items.RGBInput.FocusLost:Connect(function()
                local text = Items.RGBInput.Text
                local r, g, b, alphaVal = Library:Convert(text)
                
                if r and g and b then 
                    Cfg.Set(rgb(r, g, b), 1 - (alphaVal or 1))
                end 
            end)

            Items.InputAlpha.FocusLost:Connect(function()
                local Color, Alpha = Library:ConvertFromHex(Items.InputAlpha.Text)
                if Color then
                    Cfg.Set(Color, 1 - Alpha)
                end
            end)

            Cfg.Set(Cfg.Color, Cfg.Alpha)
            ConfigFlags[Cfg.Flag] = Cfg.Set

            return setmetatable(Cfg, Library)
        end 

        function Library:GetConfig()
            local Config = {}
            
            for Idx, Value in pairs(Flags) do
                if type(Value) == "table" and Value.Key then
                    Config[Idx] = {Active = Value.Active, Mode = Value.Mode, Key = tostring(Value.Key)}
                elseif type(Value) == "table" and Value.Transparency ~= nil and Value.Color then
                    Config[Idx] = {Transparency = Value.Transparency, Color = Value.Color:ToHex()}
                else
                    Config[Idx] = Value
                end
            end 

            return HttpService:JSONEncode(Config)
        end

        function Library:LoadConfig(JSON) 
            local success, Config = pcall(function()
                return HttpService:JSONDecode(JSON)
            end)
            
            if not success then return end
            
            for Idx, Value in pairs(Config) do                
                if Idx == "config_name_list" then 
                    continue 
                end

                local SetFunction = ConfigFlags[Idx]

                if SetFunction then 
                    pcall(function()
                        if type(Value) == "table" and Value.Transparency ~= nil and Value.Color then
                            SetFunction(hex(Value.Color), Value.Transparency)
                        elseif type(Value) == "table" and Value.Active ~= nil then 
                            SetFunction(Value)
                        else
                            SetFunction(Value)
                        end
                    end)
                end 
            end 
        end 
        
        function Library:Round(num, float) 
            local Multiplier = 1 / (float or 1)
            return math.floor(num * Multiplier + 0.5) / Multiplier
        end

        function Library:Themify(instance, theme, property)
            if not instance or not theme or not property then return end
            if not themes.utility[theme] then return end
            if not themes.utility[theme][property] then return end
            
            table.insert(themes.utility[theme][property], instance)
        end

        function Library:SaveGradient(instance, theme)
            if not instance or not theme then return end
            if not themes.gradients[theme] then return end
            
            table.insert(themes.gradients[theme], instance)
        end

        function Library:RefreshTheme(theme, newColor)
            if not themes.utility[theme] then return end
            
            for property, instances in pairs(themes.utility[theme]) do 
                for _, object in ipairs(instances) do
                    pcall(function()
                        object[property] = newColor 
                    end)
                end 
            end

            themes.preset[theme] = newColor 
        end 

        function Library:Connection(signal, callback)
            if not signal or not callback then return nil end
            
            local connection = signal:Connect(callback)
            table.insert(Library.Connections, connection)
            return connection 
        end

        function Library:CloseElement() 
            if not Library.OpenElement then 
                return 
            end

            if type(Library.OpenElement) == "table" then
                if Library.OpenElement.SetVisible then
                    pcall(function()
                        Library.OpenElement.SetVisible(false)
                    end)
                end
                if Library.OpenElement.Open ~= nil then
                    Library.OpenElement.Open = false
                end
            end

            Library.OpenElement = nil
        end

        function Library:Create(instance, options)
            local success, ins = pcall(function()
                return Instance.new(instance)
            end)
            
            if not success or not ins then return nil end

            for prop, value in pairs(options) do
                pcall(function()
                    ins[prop] = value
                end)
            end

            if instance == "TextButton" then 
                ins.AutoButtonColor = false 
            end 
            
            return ins 
        end

        function Library:Unload() 
            if Library.Items then 
                Library.Items:Destroy()
            end

            if Library.Other then 
                Library.Other:Destroy()
            end
            
            for _, connection in ipairs(Library.Connections) do 
                pcall(function()
                    connection:Disconnect()
                end)
            end

            getgenv().Library = nil 
        end
    --
    
    -- Library element functions
        function Library:Window(properties)
            local Cfg = {
                Name = properties.Name or "Nebula Premium",
                Size = properties.Size or dim2(0, 520, 0, 650),
                TabInfo = nil,
                Items = {},
                Tweening = false
            }
            
            Library.Items = Library:Create("ScreenGui", {
                Parent = CoreGui,
                Name = "NebulaPremium_" .. HttpService:GenerateGUID(false),
                Enabled = true,
                ZIndexBehavior = Enum.ZIndexBehavior.Global,
                IgnoreGuiInset = true,
                ResetOnSpawn = false
            })
            
            -- FIX: Library.Other must be Enabled = true for popups to work
            Library.Other = Library:Create("ScreenGui", {
                Parent = CoreGui,
                Name = "NebulaPremium_Other_" .. HttpService:GenerateGUID(false),
                Enabled = true,
                ZIndexBehavior = Enum.ZIndexBehavior.Global,
                IgnoreGuiInset = true,
                ResetOnSpawn = false
            })

            local Items = Cfg.Items

            -- Main Window Frame with enhanced CSGO-style borders
            Items.Window = Library:Create("Frame", {
                Parent = Library.Items,
                Name = "\0",
                Position = dim2(0.5, -Cfg.Size.X.Offset / 2, 0.5, -Cfg.Size.Y.Offset / 2),
                BorderSizePixel = 0,
                Size = Cfg.Size,
                BackgroundColor3 = themes.preset.shadow
            })
            Items.Window.Position = dim2(0, Items.Window.AbsolutePosition.X, 0, Items.Window.AbsolutePosition.Y)
            Library:Themify(Items.Window, "shadow", "BackgroundColor3")

            -- Outer dark border
            Items.OuterBorder = Library:Create("Frame", {
                Parent = Items.Window,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.OuterBorder, "border_dark", "BackgroundColor3")

            -- Inner light border
            Items.InnerBorder = Library:Create("Frame", {
                Parent = Items.OuterBorder,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.border_light
            })
            Library:Themify(Items.InnerBorder, "border_light", "BackgroundColor3")

            -- Main outline frame
            Items.Outline = Library:Create("Frame", {
                Parent = Items.InnerBorder,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.Outline, "outline", "BackgroundColor3")

            -- Accent line at top
            Items.AccentLine = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 2),
                BackgroundColor3 = themes.preset.accent
            })
            Library:Themify(Items.AccentLine, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.AccentLine,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            -- Accent line separator
            Items.AccentSeparator = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 0, 0, 3),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 1),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.AccentSeparator, "outline", "BackgroundColor3")

            -- Title bar gradient
            Items.TitleBar = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 1, 0, 4),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 20),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local titleGradient = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TitleBar,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(titleGradient, "Selected")

            -- Title text
            Items.Title = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Name,
                Parent = Items.TitleBar,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 6, 0, 0),
                Size = dim2(1, -12, 1, 0),
                TextXAlignment = Enum.TextXAlignment.Left,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Title, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Title,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Main content area inline
            Items.ContentInline = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 4, 0, 26),
                BorderSizePixel = 0,
                Size = dim2(1, -8, 1, -30),
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.ContentInline, "inline", "BackgroundColor3")

            -- Content outline
            Items.ContentOutline = Library:Create("Frame", {
                Parent = Items.ContentInline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.ContentOutline, "outline", "BackgroundColor3")

            -- Content background
            Items.ContentBackground = Library:Create("Frame", {
                Parent = Items.ContentOutline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.background
            })
            Library:Themify(Items.ContentBackground, "background", "BackgroundColor3")

            -- Page holder with tabs
            Items.PageContainer = Library:Create("Frame", {
                Parent = Items.ContentBackground,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.PageContainer, "outline", "BackgroundColor3")

            -- Tab buttons container
            Items.TabButtons = Library:Create("Frame", {
                Parent = Items.PageContainer,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 24),
                BackgroundColor3 = rgb(255, 255, 255)
            })

            -- Tab accent line
            Items.TabAccent = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.TabButtons,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 2),
                BackgroundColor3 = themes.preset.accent
            })
            Library:Themify(Items.TabAccent, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TabAccent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            -- Tab separator line
            Items.TabSeparator = Library:Create("Frame", {
                Parent = Items.TabButtons,
                Name = "\0",
                Position = dim2(0, 0, 0, 2),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 1),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.TabSeparator, "outline", "BackgroundColor3")

            local tabButtonsGradient = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TabButtons,
                Color = rgbseq{rgbkey(0, themes.preset.gradient), rgbkey(1, themes.preset.background)}
            })
            Library:SaveGradient(tabButtonsGradient, "Deselected")

            -- Tab buttons holder
            Items.Buttons = Library:Create("Frame", {
                Parent = Items.TabButtons,
                BackgroundTransparency = 1,
                Name = "\0",
                BorderSizePixel = 0,
                Size = dim2(1, 0, 1, -1),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIListLayout", {
                Parent = Items.Buttons,
                FillDirection = Enum.FillDirection.Horizontal,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = dim(0, -1)
            })
            
            Library:Create("UIPadding", {
                Parent = Items.Buttons,
                PaddingTop = dim(0, 3)
            })

            -- Tab bottom outline
            Items.TabBottomOutline = Library:Create("Frame", {
                BorderSizePixel = 0,
                AnchorPoint = vec2(0, 1),
                Parent = Items.TabButtons,
                Name = "\0",
                Position = dim2(0, 0, 1, 0),
                Size = dim2(1, 0, 0, 1),
                ZIndex = 2,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.TabBottomOutline, "outline", "BackgroundColor3")

            -- Page holder (where tab content goes)
            Items.PageHolder = Library:Create("Frame", {
                Parent = Items.PageContainer,
                Name = "\0",
                Position = dim2(0, 1, 0, 25),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -26),
                BackgroundColor3 = themes.preset.background,
                ClipsDescendants = true
            })
            Library:Themify(Items.PageHolder, "background", "BackgroundColor3")

            -- Fade overlay for tab transitions
            Items.Fade = Library:Create("Frame", {
                                Parent = Items.PageHolder,
                Name = "\0",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 1, 0),
                BorderSizePixel = 0,
                ZIndex = 10,
                BackgroundColor3 = themes.preset.background
            })
            Library:Themify(Items.Fade, "background", "BackgroundColor3")

            -- Top fade gradient for smooth look
            Items.FadeGradient = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.PageHolder,
                ZIndex = 5,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 15),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local fadeGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.FadeGradient,
                Color = rgbseq{rgbkey(0, themes.preset.gradient), rgbkey(1, themes.preset.background)},
                Transparency = numseq{numkey(0, 0), numkey(1, 1)}
            })
            Library:SaveGradient(fadeGrad, "Deselected")

            -- Keybind List
            Items.KeybindList = Library:Create("Frame", {
                Parent = Library.Items,
                Name = "\0",
                Position = dim2(0, 20, 0, 300),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.XY,
                BackgroundColor3 = themes.preset.shadow,
                Visible = false
            })
            Library:Themify(Items.KeybindList, "shadow", "BackgroundColor3")
            Library:Draggify(Items.KeybindList)

            Items.KeybindListOuter = Library:Create("Frame", {
                Parent = Items.KeybindList,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                AutomaticSize = Enum.AutomaticSize.XY,
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.KeybindListOuter, "border_dark", "BackgroundColor3")

            Items.KeybindListInner = Library:Create("Frame", {
                Parent = Items.KeybindListOuter,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                AutomaticSize = Enum.AutomaticSize.XY,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.KeybindListInner, "outline", "BackgroundColor3")

            Items.KeybindListAccent = Library:Create("Frame", {
                Parent = Items.KeybindListInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 2),
                BackgroundColor3 = themes.preset.accent
            })
            Library:Themify(Items.KeybindListAccent, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.KeybindListAccent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            Items.KeybindListSeparator = Library:Create("Frame", {
                Parent = Items.KeybindListInner,
                Name = "\0",
                Position = dim2(0, 0, 0, 3),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 1),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.KeybindListSeparator, "outline", "BackgroundColor3")

            Items.KeybindListGradient = Library:Create("Frame", {
                Parent = Items.KeybindListInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 4),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 16),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local kbGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.KeybindListGradient,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(kbGrad, "Selected")

            Items.KeybindListContent = Library:Create("Frame", {
                Parent = Items.KeybindListInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 4),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -5),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.gradient
            })
            Library:Themify(Items.KeybindListContent, "gradient", "BackgroundColor3")
            
            Library:Create("UIPadding", {
                PaddingTop = dim(0, 4),
                PaddingBottom = dim(0, 6),
                PaddingLeft = dim(0, 6),
                PaddingRight = dim(0, 6),
                Parent = Items.KeybindListContent
            })

            Items.KeybindListTitle = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = "Keybinds",
                Parent = Items.KeybindListContent,
                Name = "\0",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 0, 14),
                TextXAlignment = Enum.TextXAlignment.Left,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.KeybindListTitle, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.KeybindListTitle,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            Items.KeybindElements = Library:Create("Frame", {
                BorderSizePixel = 0,
                Parent = Items.KeybindListContent,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 0, 0, 18),
                Size = dim2(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library.KeybindParent = Items.KeybindElements
            
            Library:Create("UIListLayout", {
                Parent = Items.KeybindElements,
                Padding = dim(0, 2),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            -- Watermark
            Items.Watermark = Library:Create("Frame", {
                Parent = Library.Items,
                Name = "\0",
                Position = dim2(0, 20, 0, 20),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.XY,
                BackgroundColor3 = themes.preset.shadow,
                Visible = false
            })
            Library:Themify(Items.Watermark, "shadow", "BackgroundColor3")
            Library:Draggify(Items.Watermark)

            Items.WatermarkOuter = Library:Create("Frame", {
                Parent = Items.Watermark,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                AutomaticSize = Enum.AutomaticSize.XY,
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.WatermarkOuter, "border_dark", "BackgroundColor3")

            Items.WatermarkInner = Library:Create("Frame", {
                Parent = Items.WatermarkOuter,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                AutomaticSize = Enum.AutomaticSize.XY,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.WatermarkInner, "outline", "BackgroundColor3")

            Items.WatermarkAccent = Library:Create("Frame", {
                Parent = Items.WatermarkInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 2),
                BackgroundColor3 = themes.preset.accent
            })
            Library:Themify(Items.WatermarkAccent, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.WatermarkAccent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            Items.WatermarkSeparator = Library:Create("Frame", {
                Parent = Items.WatermarkInner,
                Name = "\0",
                Position = dim2(0, 0, 0, 3),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 1),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.WatermarkSeparator, "outline", "BackgroundColor3")

            Items.WatermarkContent = Library:Create("Frame", {
                Parent = Items.WatermarkInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 4),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -5),
                AutomaticSize = Enum.AutomaticSize.XY,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local wmGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.WatermarkContent,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(wmGrad, "Selected")

            Items.WatermarkTitle = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                RichText = true,
                Text = Cfg.Name .. " <font color=\"#888888\">|</font> v1.0",
                Parent = Items.WatermarkContent,
                Name = "\0",
                BackgroundTransparency = 1,
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.WatermarkTitle, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.WatermarkTitle,
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            Library:Create("UIPadding", {
                PaddingTop = dim(0, 3),
                PaddingBottom = dim(0, 3),
                PaddingLeft = dim(0, 8),
                PaddingRight = dim(0, 8),
                Parent = Items.WatermarkTitle
            })

            -- Dragging and resizing
            Library:Draggify(Items.Window)
            Library:Resizify(Items.Window)

            -- Window functions
            function Cfg.ToggleMenu(bool)
                if Cfg.Tweening then 
                    return 
                end 

                Library.MenuOpen = bool
                Cfg.Tweening = true 

                if bool then 
                    Items.Window.Visible = true
                    Library.Items.Enabled = true
                end

                local targetTransparency = bool and 0 or 1
                local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.InOut)

                -- Simple fade approach
                local mainTween = TweenService:Create(Items.Window, tweenInfo, {
                    BackgroundTransparency = targetTransparency
                })
                mainTween:Play()

                -- Fade all children
                for _, descendant in ipairs(Items.Window:GetDescendants()) do
                    local props = Library:GetTransparency(descendant)
                    if props then
                        for _, prop in ipairs(props) do
                            pcall(function()
                                local currentVal = descendant[prop]
                                if type(currentVal) == "number" then
                                    if bool then
                                        -- Fading in: set to 1 first, then tween to original
                                        local originalVal = currentVal
                                        descendant[prop] = 1
                                        TweenService:Create(descendant, tweenInfo, {[prop] = originalVal}):Play()
                                    else
                                        -- Fading out: tween to 1
                                        TweenService:Create(descendant, tweenInfo, {[prop] = 1}):Play()
                                    end
                                end
                            end)
                        end
                    end
                end

                task.delay(0.35, function()
                    Cfg.Tweening = false
                    if not bool then
                        Items.Window.Visible = false
                    end
                end)
            end

            function Cfg.ChangeTitle(text)
                if text and text ~= "" then
                    Items.Title.Text = text
                end
            end

            function Cfg.ToggleWatermark(bool)
                Items.Watermark.Visible = bool
            end

            function Cfg.ChangeWatermarkTitle(text)
                if text and text ~= "" then
                    Items.WatermarkTitle.Text = text
                end
            end

            function Cfg.ToggleStatus(bool)
                -- Status functionality can be added here
            end

            function Cfg.ToggleKeybindList(bool)
                Items.KeybindList.Visible = bool
            end

            -- Mark as initialized after a delay to prevent menu toggle during setup
            task.delay(0.5, function()
                Library.Initialized = true
            end)

            return setmetatable(Cfg, Library)
        end

        function Library:Tab(properties)
            local Cfg = {
                Name = properties.Name or properties.name or "Tab",
                Items = {}
            }

            local Items = Cfg.Items

            -- Tab Button
            Items.Button = Library:Create("TextButton", {
                Parent = self.Items.Buttons,
                Name = "\0",
                Size = dim2(0, 0, 1, 0),
                BorderSizePixel = 0,
                Text = "",
                AutomaticSize = Enum.AutomaticSize.X,
                AutoButtonColor = false,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Items.Background = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Name,
                Parent = Items.Button,
                Name = "\0",
                BackgroundTransparency = 0,
                Size = dim2(0, 0, 1, 0),
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = themes.preset.tab_background
            })
            Library:Themify(Items.Background, "tab_background", "BackgroundColor3")
            
            Items.TextPadding = Library:Create("UIPadding", {
                Parent = Items.Background,
                PaddingRight = dim(0, 10),
                PaddingLeft = dim(0, 8)
            })
            
            Library:Create("UIStroke", {
                Parent = Items.Background,
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            Items.Fill = Library:Create("Frame", {
                BorderSizePixel = 0,
                AnchorPoint = vec2(0, 1),
                Parent = Items.Button,
                Name = "\0",
                Position = dim2(0, 0, 1, 1),
                Size = dim2(1, 0, 0, 1),
                ZIndex = 3,
                BackgroundTransparency = 1,
                BackgroundColor3 = themes.preset.gradient
            })
            Library:Themify(Items.Fill, "gradient", "BackgroundColor3")
            
            local buttonGradient = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.Button,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(buttonGradient, "Selected")
            
            Items.UIStroke = Library:Create("UIStroke", {
                Color = themes.preset.outline,
                LineJoinMode = Enum.LineJoinMode.Miter,
                Parent = Items.Button,
                ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            })
            Library:Themify(Items.UIStroke, "outline", "Color")

            -- Page content
            Items.Page = Library:Create("Frame", {
                Parent = Library.Other,
                Name = "\0",
                Visible = false,
                BackgroundTransparency = 1,
                Position = dim2(0, 4, 0, 4),
                BorderSizePixel = 0,
                Size = dim2(1, -8, 1, -8),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIListLayout", {
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalFlex = Enum.UIFlexAlignment.Fill,
                Parent = Items.Page,
                Padding = dim(0, 6),
                SortOrder = Enum.SortOrder.LayoutOrder,
                VerticalFlex = Enum.UIFlexAlignment.Fill
            })
            
            Items.Left = Library:Create("Frame", {
                Parent = Items.Page,
                BackgroundTransparency = 1,
                Name = "\0",
                BorderSizePixel = 0,
                Size = dim2(0, 100, 0, 100),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIListLayout", {
                Parent = Items.Left,
                Padding = dim(0, 6),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            Items.Right = Library:Create("Frame", {
                Parent = Items.Page,
                BackgroundTransparency = 1,
                Name = "\0",
                BorderSizePixel = 0,
                Size = dim2(0, 100, 0, 100),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIListLayout", {
                Parent = Items.Right,
                Padding = dim(0, 6),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            function Cfg.OpenTab()
                local Tab = self.TabInfo
                
                if Tab then
                    Library:Tween(Tab.Fill, {BackgroundTransparency = 1})
                    Library:Tween(Tab.Background, {BackgroundTransparency = 0})
                    Tab.Page.Visible = false
                    Tab.Page.Parent = Library.Other
                end

                Library:Tween(Items.Fill, {BackgroundTransparency = 0})
                Library:Tween(Items.Background, {BackgroundTransparency = 1})

                Items.Page.Parent = self.Items.PageHolder
                Items.Page.Visible = true

                if Tab ~= Items then
                    self.Items.Fade.BackgroundTransparency = 0
                    Library:Tween(self.Items.Fade, {BackgroundTransparency = 1})
                end

                self.TabInfo = Items
            end

            Items.Button.MouseButton1Click:Connect(function()
                Library:CloseElement()
                Cfg.OpenTab()
            end)

            if not self.TabInfo then
                Items.TextPadding.PaddingRight = dim(0, 12)
                Cfg.OpenTab()
            end

            return setmetatable(Cfg, Library)
        end

        function Library:Section(properties)
            local Cfg = {
                Name = properties.Name or properties.name or "Section",
                Side = properties.Side or properties.side or "Left",
                Size = properties.Size or properties.size or nil,
                Items = {}
            }

            local Items = Cfg.Items

            -- Section outer frame
            Items.Section = Library:Create("Frame", {
                Parent = self.Items[Cfg.Side],
                Name = "\0",
                Size = dim2(1, 0, Cfg.Size or 0, 0),
                BorderSizePixel = 0,
                AutomaticSize = Cfg.Size and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.shadow
            })
            Library:Themify(Items.Section, "shadow", "BackgroundColor3")

            Items.SectionOuter = Library:Create("Frame", {
                Parent = Items.Section,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                AutomaticSize = Cfg.Size and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.SectionOuter, "border_dark", "BackgroundColor3")

            Items.SectionInner = Library:Create("Frame", {
                Parent = Items.SectionOuter,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                AutomaticSize = Cfg.Size and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.SectionInner, "outline", "BackgroundColor3")

            -- Section accent line
            Items.Accent = Library:Create("Frame", {
                Parent = Items.SectionInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 2),
                BackgroundColor3 = themes.preset.accent
            })
            Library:Themify(Items.Accent, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.Accent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            Items.AccentSeparator = Library:Create("Frame", {
                Parent = Items.SectionInner,
                Name = "\0",
                Position = dim2(0, 0, 0, 3),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 1),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.AccentSeparator, "outline", "BackgroundColor3")

            -- Section title gradient
            Items.TitleGradient = Library:Create("Frame", {
                Parent = Items.SectionInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 4),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 18),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local titleGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TitleGradient,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(titleGrad, "Selected")

            -- Section title
            Items.Title = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Name,
                Parent = Items.SectionInner,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 6, 0, 5),
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 2
            })
            Library:Themify(Items.Title, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Title,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Content inline
            Items.Inline = Library:Create("Frame", {
                Parent = Items.SectionInner,
                Size = dim2(1, -2, Cfg.Size and 1 or 0, Cfg.Size and -6 or 0),
                Name = "\0",
                Position = dim2(0, 1, 0, 4),
                BorderSizePixel = 0,
                AutomaticSize = Cfg.Size and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.gradient
            })
            Library:Themify(Items.Inline, "gradient", "BackgroundColor3")
            
            Library:Create("UIPadding", {
                PaddingBottom = dim(0, 6),
                Parent = Items.Inline
            })

            -- Elements container
            Items.Elements = Library:Create("Frame", {
                BorderSizePixel = 0,
                Parent = Items.Inline,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 8, 0, 22),
                Size = dim2(1, -16, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            -- Scrolling section if size is specified
            if Cfg.Size then
                Items.ScrollingFrame = Library:Create("ScrollingFrame", {
                    Active = true,
                    ScrollingEnabled = true,
                    AutomaticCanvasSize = Enum.AutomaticSize.Y,
                    ZIndex = 2,
                    BorderSizePixel = 0,
                    CanvasSize = dim2(0, 0, 0, 0),
                    ScrollBarImageColor3 = themes.preset.accent,
                    MidImage = "rbxassetid://120496541810421",
                    BorderColor3 = rgb(0, 0, 0),
                    ScrollBarThickness = 0,
                    Parent = Items.Inline,
                    Size = dim2(1, -4, 1, -24),
                    TopImage = "rbxassetid://118750478739322",
                    Position = dim2(0, 0, 0, 22),
                    BottomImage = "rbxassetid://74268315755026",
                    BackgroundTransparency = 1,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                Library:Themify(Items.ScrollingFrame, "accent", "ScrollBarImageColor3")
                
                Items.ScrollingLine = Library:Create("Frame", {
                    Visible = false,
                    BorderSizePixel = 0,
                    AnchorPoint = vec2(1, 0),
                    Name = "\0",
                    Position = dim2(1, -3, 0, 22),
                    Parent = Items.Inline,
                    Size = dim2(0, 3, 1, -24),
                    BackgroundColor3 = themes.preset.outline
                })
                Library:Themify(Items.ScrollingLine, "outline", "BackgroundColor3")
                
                Items.Elements:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
                    if Items.ScrollingFrame.AbsoluteSize.Y < Items.Elements.AbsoluteSize.Y then
                        Items.ScrollingLine.Visible = true
                        Library:Tween(Items.ScrollingFrame, {ScrollBarThickness = 2})
                        Library:Tween(Items.Elements, {Size = dim2(1, -18, 0, 0)})
                    else
                        Items.ScrollingLine.Visible = false
                        Library:Tween(Items.ScrollingFrame, {ScrollBarThickness = 0})
                        Library:Tween(Items.Elements, {Size = dim2(1, -14, 0, 0)})
                    end
                end)

                Items.Elements.Parent = Items.ScrollingFrame
                Items.Elements.Position = dim2(0, 8, 0, 0)
            end

            Library:Create("UIListLayout", {
                Parent = Items.Elements,
                Padding = dim(0, 5),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            return setmetatable(Cfg, Library)
        end

        function Library:Toggle(properties)
            local Cfg = {
                Name = properties.Name or "Toggle",
                Flag = properties.Flag or properties.Name or "Toggle",
                Enabled = properties.Default or false,
                Callback = properties.Callback or function() end,
                Folding = properties.Folding or false,
                Items = {}
            }

            local Items = Cfg.Items

            Items.Object = Library:Create("TextButton", {
                FontFace = Library.Font,
                TextColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                Text = "",
                Parent = self.Items.GroupElements or self.Items.Elements,
                BackgroundTransparency = 1,
                Name = "\0",
                Size = dim2(1, 0, 0, 12),
                TextSize = 14,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            -- Toggle checkbox outer
            Items.Outer = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.Object,
                BorderSizePixel = 0,
                Size = dim2(0, 12, 0, 12),
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.Outer, "border_dark", "BackgroundColor3")

            Items.Outline = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.Outer,
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.Outline, "outline", "BackgroundColor3")

            Items.Inline = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.Inline, "inline", "BackgroundColor3")

            Items.Accent = Library:Create("Frame", {
                Parent = Items.Inline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline
            })
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.Accent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            -- Toggle name
            Items.Name = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Name,
                Parent = Items.Object,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 18, 0, -1),
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Name, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Name,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Components container (for keybinds, colorpickers)
            Items.Components = Library:Create("Frame", {
                Parent = Items.Object,
                Name = "\0",
                Position = dim2(1, 0, 0, 0),
                BorderSizePixel = 0,
                Size = dim2(0, 0, 1, 0),
                BackgroundTransparency = 1,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIListLayout", {
                Parent = Items.Components,
                FillDirection = Enum.FillDirection.Horizontal,
                SortOrder = Enum.SortOrder.LayoutOrder,
                HorizontalAlignment = Enum.HorizontalAlignment.Right,
                Padding = dim(0, 4)
            })

            -- Folding group
            if Cfg.Folding then
                Items.ArrowHolder = Library:Create("Frame", {
                    Parent = Items.Components,
                    BackgroundTransparency = 1,
                    Name = "\0",
                    BorderSizePixel = 0,
                    Size = dim2(0, 10, 0, 10),
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                
                Items.Arrow = Library:Create("ImageLabel", {
                    ScaleType = Enum.ScaleType.Fit,
                    BorderSizePixel = 0,
                    Parent = Items.ArrowHolder,
                    Name = "\0",
                    BackgroundTransparency = 1,
                    Size = dim2(1, 0, 1, 0),
                    Image = "rbxassetid://108270041153906",
                    ImageColor3 = themes.preset.text_color,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                Library:Themify(Items.Arrow, "text_color", "ImageColor3")
                
                Items.Group = Library:Create("Frame", {
                    LayoutOrder = 2,
                    BorderSizePixel = 0,
                    Parent = Library.Other,
                    Name = "\0",
                    Visible = false,
                    BackgroundTransparency = 1,
                    Position = dim2(0, 6, 0, 20),
                    Size = dim2(1, -12, 0, 0),
                    AutomaticSize = Enum.AutomaticSize.Y,
                    BackgroundColor3 = rgb(255, 255, 255)
                })

                Items.Fade = Library:Create("Frame", {
                    Parent = Items.Group,
                    Name = "\0",
                    BackgroundTransparency = 1,
                    Size = dim2(1, 12, 1, 0),
                    BorderSizePixel = 0,
                    ZIndex = 5,
                    BackgroundColor3 = themes.preset.gradient
                })
                Library:Themify(Items.Fade, "gradient", "BackgroundColor3")
                
                Items.GroupElements = Library:Create("Frame", {
                    Parent = Items.Group,
                    Name = "\0",
                    BackgroundTransparency = 1,
                    Size = dim2(1, 0, 0, 0),
                    BorderSizePixel = 0,
                    AutomaticSize = Enum.AutomaticSize.Y,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                
                Library:Create("UIListLayout", {
                    Parent = Items.GroupElements,
                    Padding = dim(0, 5),
                    SortOrder = Enum.SortOrder.LayoutOrder
                })
                
                Library:Create("UIPadding", {
                    PaddingLeft = dim(0, 12),
                    Parent = Items.GroupElements
                })
                
                Items.GroupLine = Library:Create("Frame", {
                    Parent = Items.Group,
                    Name = "\0",
                    Position = dim2(0, 4, 0, 0),
                    BorderSizePixel = 0,
                    Size = dim2(0, 2, 1, 0),
                    BackgroundColor3 = themes.preset.accent
                })
                Library:Themify(Items.GroupLine, "accent", "BackgroundColor3")
                
                Library:Create("UIGradient", {
                    Rotation = 90,
                    Transparency = numseq{numkey(0, 1), numkey(0.1, 0), numkey(0.9, 0), numkey(1, 1)},
                    Parent = Items.GroupLine
                })
            end

            function Cfg.Set(bool)
                if type(bool) ~= "boolean" then return end
                
                Cfg.Enabled = bool
                Flags[Cfg.Flag] = bool

                -- Update checkbox visual
                local targetColor = bool and themes.preset.accent or themes.preset.inline
                Library:Tween(Items.Accent, {BackgroundColor3 = targetColor})
                
                -- Handle folding
                if Cfg.Folding then
                    Items.Group.Visible = bool
                    Items.Group.Parent = bool and (self.Items.GroupElements or self.Items.Elements) or Library.Other
                    
                    Items.Fade.BackgroundTransparency = 0
                    Library:Tween(Items.Fade, {BackgroundTransparency = 1})
                    Library:Tween(Items.Arrow, {Rotation = bool and 180 or 0})
                end

                -- Call callback
                task.spawn(function()
                    Cfg.Callback(bool)
                end)
            end

            Items.Object.MouseButton1Click:Connect(function()
                Cfg.Set(not Cfg.Enabled)
            end)

            Cfg.Set(Cfg.Enabled)
            ConfigFlags[Cfg.Flag] = Cfg.Set

            return setmetatable(Cfg, Library)
        end

        function Library:Slider(properties)
            local Cfg = {
                Name = properties.Name or "Slider",
                Suffix = properties.Suffix or "",
                Flag = properties.Flag or properties.Name or "Slider",
                Callback = properties.Callback or function() end,
                Min = properties.Min or 0,
                Max = properties.Max or 100,
                Intervals = properties.Decimal or 1,
                Value = properties.Default or properties.Min or 0,
                Dragging = false,
                Items = {}
            }

            local Items = Cfg.Items

            Items.Slider = Library:Create("TextButton", {
                FontFace = Library.Font,
                TextColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                Text = "",
                Parent = self.Items.GroupElements or self.Items.Elements,
                BackgroundTransparency = 1,
                Name = "\0",
                Size = dim2(1, 0, 0, 28),
                TextSize = 14,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            -- Slider name
            Items.Name = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Name,
                Parent = Items.Slider,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Name, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Name,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Slider bar container
            Items.Outer = Library:Create("TextButton", {
                Parent = Items.Slider,
                Text = "",
                AutoButtonColor = false,
                Name = "\0",
                Position = dim2(0, 0, 0, 16),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 12),
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.Outer, "border_dark", "BackgroundColor3")

            Items.Outline = Library:Create("Frame", {
                Parent = Items.Outer,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.Outline, "outline", "BackgroundColor3")

            Items.Inline = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.Inline, "inline", "BackgroundColor3")

            -- Accent fill
            Items.Accent = Library:Create("Frame", {
                Parent = Items.Inline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(0.5, -2, 1, -2),
                BackgroundColor3 = themes.preset.accent
            })
            Library:Themify(Items.Accent, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.Accent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            -- Value text
            Items.Value = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = "0",
                Parent = Items.Outer,
                Name = "\0",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 1, 0),
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 2
            })
            Library:Themify(Items.Value, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Value,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Components
            Items.Components = Library:Create("Frame", {
                Parent = Items.Slider,
                Name = "\0",
                Position = dim2(1, 0, 0, 0),
                BorderSizePixel = 0,
                Size = dim2(0, 0, 0, 12),
                BackgroundTransparency = 1,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIListLayout", {
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalAlignment = Enum.HorizontalAlignment.Right,
                Parent = Items.Components,
                Padding = dim(0, 4),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            -- Plus/Minus buttons
            Items.Minus = Library:Create("ImageButton", {
                ScaleType = Enum.ScaleType.Fit,
                AutoButtonColor = false,
                BorderSizePixel = 0,
                Parent = Items.Components,
                Image = "rbxassetid://120056247050601",
                BackgroundTransparency = 1,
                Name = "\0",
                Size = dim2(0, 8, 1, 0),
                ImageColor3 = themes.preset.text_color,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Minus, "text_color", "ImageColor3")
            
            Items.Plus = Library:Create("ImageButton", {
                ScaleType = Enum.ScaleType.Fit,
                AutoButtonColor = false,
                BorderSizePixel = 0,
                Parent = Items.Components,
                Image = "rbxassetid://120458671764177",
                BackgroundTransparency = 1,
                Name = "\0",
                Size = dim2(0, 8, 1, 0),
                ImageColor3 = themes.preset.text_color,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Plus, "text_color", "ImageColor3")

            function Cfg.Set(value)
                if type(value) ~= "number" then return end
                
                Cfg.Value = math.clamp(Library:Round(value, Cfg.Intervals), Cfg.Min, Cfg.Max)

                local percent = (Cfg.Value - Cfg.Min) / (Cfg.Max - Cfg.Min)
                Items.Accent.Size = dim2(percent, Cfg.Value == Cfg.Min and 0 or -2, 1, -2)
                Items.Value.Text = tostring(Cfg.Value) .. Cfg.Suffix

                Flags[Cfg.Flag] = Cfg.Value
                
                task.spawn(function()
                    Cfg.Callback(Cfg.Value)
                end)
            end

            Items.Outer.MouseButton1Down:Connect(function()
                Cfg.Dragging = true
            end)

            Items.Minus.MouseButton1Click:Connect(function()
                Cfg.Set(Cfg.Value - Cfg.Intervals)
            end)

            Items.Plus.MouseButton1Click:Connect(function()
                Cfg.Set(Cfg.Value + Cfg.Intervals)
            end)

            Library:Connection(InputService.InputChanged, function(input)
                if Cfg.Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local percent = math.clamp((input.Position.X - Items.Outer.AbsolutePosition.X) / Items.Outer.AbsoluteSize.X, 0, 1)
                    local value = ((Cfg.Max - Cfg.Min) * percent) + Cfg.Min
                    Cfg.Set(value)
                end
            end)

            Library:Connection(InputService.InputEnded, function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Cfg.Dragging = false
                end
            end)

            Cfg.Set(Cfg.Value)
            ConfigFlags[Cfg.Flag] = Cfg.Set

            return setmetatable(Cfg, Library)
        end

        function Library:Label(properties)
            local Cfg = {
                Name = properties.Name or "Label",
                Items = {}
            }

            local Items = Cfg.Items

            Items.Label = Library:Create("TextButton", {
                LayoutOrder = 1,
                FontFace = Library.Font,
                TextColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                Text = "",
                Parent = self.Items.GroupElements or self.Items.Elements,
                BackgroundTransparency = 1,
                Name = "\0",
                Size = dim2(1, 0, 0, 12),
                TextSize = 14,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Items.Name = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Name,
                Parent = Items.Label,
                BackgroundTransparency = 1,
                Name = "\0",
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Name, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Name,
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            Items.Components = Library:Create("Frame", {
                Parent = Items.Label,
                Name = "\0",
                Position = dim2(1, 0, 0, 0),
                BorderSizePixel = 0,
                Size = dim2(0, 0, 1, 0),
                BackgroundTransparency = 1,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIListLayout", {
                Parent = Items.Components,
                SortOrder = Enum.SortOrder.LayoutOrder,
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalAlignment = Enum.HorizontalAlignment.Right,
                Padding = dim(0, 4)
            })

            function Cfg.Set(text)
                if text then
                    Items.Name.Text = text
                end
            end

            return setmetatable(Cfg, Library)
        end

        function Library:Colorpicker(properties)
            local Cfg = {
                Name = properties.Name or "Color",
                Flag = properties.Flag or properties.Name or "Colorpicker",
                Callback = properties.Callback or function() end,
                Color = properties.Color or color(1, 1, 1),
                Alpha = properties.Alpha or properties.Transparency or 0,
                Open = false,
                Mode = properties.Mode or "Animation",
                Items = {}
            }

            local Picker = self:Keypicker(Cfg)

            Cfg.Items = Picker.Items
            Cfg.Set = Picker.Set
            Cfg.SetVisible = Picker.SetVisible

            Cfg.Set(Cfg.Color, Cfg.Alpha)
            ConfigFlags[Cfg.Flag] = Cfg.Set

            return setmetatable(Cfg, Library)
        end

        function Library:Button(properties)
            local Cfg = {
                Name = properties.Name or "Button",
                Callback = properties.Callback or function() end,
                Items = {}
            }

            local Items = Cfg.Items

            Items.Button = Library:Create("TextButton", {
                FontFace = Library.Font,
                TextColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                Text = "",
                Parent = self.Items.GroupElements or self.Items.Elements,
                Name = "\0",
                BackgroundTransparency = 1,
                Size = dim2(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                TextSize = 14,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            Items.Outer = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.Button,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 20),
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.Outer, "border_dark", "BackgroundColor3")

            Items.Outline = Library:Create("Frame", {
                Parent = Items.Outer,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.Outline, "outline", "BackgroundColor3")

            Items.Inline = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.Inline, "inline", "BackgroundColor3")

            Items.Background = Library:Create("Frame", {
                Parent = Items.Inline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local btnGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.Background,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(btnGrad, "Selected")

            Items.Name = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Name,
                Parent = Items.Background,
                Name = "\0",
                Size = dim2(1, 0, 1, 0),
                BackgroundTransparency = 1,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Name, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Name,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            Items.Button.MouseButton1Click:Connect(function()
                -- Flash effect
                Items.Name.TextColor3 = rgb(255, 255, 255)
                Library:Tween(Items.Name, {TextColor3 = themes.preset.text_color})
                
                task.spawn(function()
                    Cfg.Callback()
                end)
            end)

            return setmetatable(Cfg, Library)
        end

        function Library:Dropdown(properties)
            local Cfg = {
                Name = properties.Name or nil,
                Flag = properties.Flag or properties.Name or "Dropdown",
                Options = properties.Options or {},
                Callback = properties.Callback or function() end,
                Multi = properties.Multi or false,
                Open = false,
                OptionInstances = {},
                MultiItems = {},
                Items = {},
                Ignore = properties.Ignore or false
            }

            Cfg.Default = properties.Default or (Cfg.Multi and {}) or Cfg.Options[1] or ""
            Flags[Cfg.Flag] = Cfg.Default

            local Items = Cfg.Items

            Items.Dropdown = Library:Create("TextButton", {
                FontFace = Library.Font,
                TextColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                Text = "",
                Parent = self.Items.GroupElements or self.Items.Elements,
                BackgroundTransparency = 1,
                Name = "\0",
                Size = dim2(1, 0, 0, Cfg.Name and 34 or 20),
                TextSize = 14,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            -- Name label (if provided)
            if Cfg.Name then
                Items.Name = Library:Create("TextLabel", {
                    FontFace = Library.Font,
                    TextColor3 = themes.preset.text_color,
                    BorderSizePixel = 0,
                    Text = Cfg.Name,
                    Parent = Items.Dropdown,
                    Name = "\0",
                    BackgroundTransparency = 1,
                    Position = dim2(0, 0, 0, 0),
                    AutomaticSize = Enum.AutomaticSize.XY,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                Library:Themify(Items.Name, "text_color", "TextColor3")
                
                Library:Create("UIStroke", {
                    Parent = Items.Name,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })
            end

            -- Dropdown button
            Items.Outer = Library:Create("TextButton", {
                Parent = Items.Dropdown,
                AutoButtonColor = false,
                Text = "",
                Name = "\0",
                Position = dim2(0, 0, 0, Cfg.Name and 14 or 0),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 20),
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.Outer, "border_dark", "BackgroundColor3")

            Items.Outline = Library:Create("Frame", {
                Parent = Items.Outer,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.Outline, "outline", "BackgroundColor3")

            Items.Inline = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.Inline, "inline", "BackgroundColor3")

            Items.Background = Library:Create("Frame", {
                Parent = Items.Inline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local dropGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.Background,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(dropGrad, "Selected")

            Items.InnerText = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = "",
                Parent = Items.Background,
                Name = "\0",
                Size = dim2(1, -20, 1, 0),
                BackgroundTransparency = 1,
                Position = dim2(0, 4, 0, 0),
                TextXAlignment = Enum.TextXAlignment.Left,
                TextTruncate = Enum.TextTruncate.AtEnd,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.InnerText, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.InnerText,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            Items.Icon = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Multi and "..." or "-",
                Parent = Items.Background,
                Name = "\0",
                AnchorPoint = vec2(1, 0),
                Size = dim2(0, 0, 1, 0),
                BackgroundTransparency = 1,
                Position = dim2(1, -4, 0, 0),
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Icon, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Icon,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Dropdown popup
            Items.DropdownElements = Library:Create("Frame", {
                Parent = Library.Other,
                Size = dim2(0, 0, 0, 0),
                Name = "\0",
                Position = dim2(0, 0, 0, 0),
                BorderSizePixel = 0,
                Visible = false,
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.border_dark,
                ZIndex = 100
            })
            Library:Themify(Items.DropdownElements, "border_dark", "BackgroundColor3")

            Items.DropdownOutline = Library:Create("Frame", {
                Parent = Items.DropdownElements,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.outline,
                ZIndex = 100
            })
            Library:Themify(Items.DropdownOutline, "outline", "BackgroundColor3")

            Items.DropdownInline = Library:Create("Frame", {
                Parent = Items.DropdownOutline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.inline,
                ZIndex = 100
            })
            Library:Themify(Items.DropdownInline, "inline", "BackgroundColor3")

            Items.DropdownHolder = Library:Create("Frame", {
                Parent = Items.DropdownInline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 100
            })
            
            local holderGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.DropdownHolder,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(holderGrad, "Selected")
            
            Library:Create("UIListLayout", {
                Parent = Items.DropdownHolder,
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            function Cfg.RenderOption(text)
                local Button = Library:Create("TextButton", {
                    FontFace = Library.Font,
                    TextColor3 = rgb(160, 160, 160),
                    BorderSizePixel = 0,
                    Text = text,
                    Parent = Items.DropdownHolder,
                    Name = "\0",
                    ZIndex = 101,
                    Size = dim2(1, 0, 0, 0),
                    BackgroundTransparency = 1,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    AutomaticSize = Enum.AutomaticSize.Y,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                
                Library:Create("UIStroke", {
                    Parent = Button,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })
                
                Library:Create("UIPadding", {
                    PaddingTop = dim(0, 3),
                    PaddingBottom = dim(0, 3),
                    Parent = Button,
                    PaddingRight = dim(0, 4),
                    PaddingLeft = dim(0, 4)
                })

                table.insert(Cfg.OptionInstances, Button)
                return Button
            end

            function Cfg.SetVisible(bool)
                if bool then
                    Library:CloseElement()
                    Library.OpenElement = Cfg
                end

                Items.DropdownElements.Position = dim2(0, Items.Outer.AbsolutePosition.X, 0, Items.Outer.AbsolutePosition.Y + Items.Outer.AbsoluteSize.Y + 2)
                Items.DropdownElements.Size = dim_offset(Items.Outer.AbsoluteSize.X, 0)
                Items.DropdownElements.Visible = bool
                Items.DropdownElements.Parent = bool and Library.Items or Library.Other

                if not Cfg.Multi then
                    Items.Icon.Text = bool and "+" or "-"
                end
            end

            function Cfg.Set(value)
                local Selected = {}
                local IsTable = type(value) == "table"

                for _, option in ipairs(Cfg.OptionInstances) do
                    local isSelected = option.Text == value or (IsTable and table.find(value, option.Text))
                    
                    if isSelected then
                        table.insert(Selected, option.Text)
                        option.TextColor3 = themes.preset.text_color
                    else
                        option.TextColor3 = rgb(160, 160, 160)
                    end
                end

                Cfg.MultiItems = Selected
                Items.InnerText.Text = table.concat(Selected, ", ")
                Flags[Cfg.Flag] = IsTable and Selected or Selected[1]

                task.spawn(function()
                    Cfg.Callback(Flags[Cfg.Flag])
                end)
            end

            function Cfg.RefreshOptions(options)
                for _, option in ipairs(Cfg.OptionInstances) do
                    option:Destroy()
                end
                Cfg.OptionInstances = {}

                for _, option in ipairs(options) do
                    local Button = Cfg.RenderOption(option)

                    Button.MouseButton1Click:Connect(function()
                        if Cfg.Multi then
                            local idx = table.find(Cfg.MultiItems, Button.Text)
                            if idx then
                                table.remove(Cfg.MultiItems, idx)
                            else
                                table.insert(Cfg.MultiItems, Button.Text)
                            end
                            Cfg.Set(Cfg.MultiItems)
                        else
                            Cfg.SetVisible(false)
                            Cfg.Open = false
                            Cfg.Set(Button.Text)
                        end
                    end)
                end
            end

            Items.Outer.MouseButton1Click:Connect(function()
                Cfg.Open = not Cfg.Open
                Cfg.SetVisible(Cfg.Open)
            end)

            Library:Connection(InputService.InputBegan, function(input, gameProcessed)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    if Items.DropdownElements.Visible and not Library:Hovering({Items.DropdownElements, Items.Dropdown}) then
                        Cfg.SetVisible(false)
                        Cfg.Open = false
                    end
                end
            end)

            Cfg.RefreshOptions(Cfg.Options)
            Cfg.Set(Cfg.Default)
            ConfigFlags[Cfg.Flag] = Cfg.Set

            return setmetatable(Cfg, Library)
        end

        function Library:Textbox(properties)
            local Cfg = {
                Name = properties.Name or "TextBox",
                PlaceHolder = properties.PlaceHolder or properties.PlaceHolderText or "Type here...",
                Default = properties.Default or "",
                Flag = properties.Flag or properties.Name or "TextBox",
                Callback = properties.Callback or function() end,
                Items = {}
            }

            Flags[Cfg.Flag] = Cfg.Default

            local Items = Cfg.Items

            Items.Textbox = Library:Create("TextButton", {
                FontFace = Library.Font,
                TextColor3 = rgb(0, 0, 0),
                BorderSizePixel = 0,
                Text = "",
                Parent = self.Items.GroupElements or self.Items.Elements,
                BackgroundTransparency = 1,
                Name = "\0",
                Size = dim2(1, 0, 0, 34),
                TextSize = 14,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            Items.Name = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Name,
                Parent = Items.Textbox,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Name, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Name,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            Items.Outer = Library:Create("Frame", {
                Parent = Items.Textbox,
                Name = "\0",
                Position = dim2(0, 0, 0, 14),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 20),
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.Outer, "border_dark", "BackgroundColor3")

            Items.Outline = Library:Create("Frame", {
                Parent = Items.Outer,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.Outline, "outline", "BackgroundColor3")

            Items.Inline = Library:Create("Frame", {
                Parent = Items.Outline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.Inline, "inline", "BackgroundColor3")

            Items.Background = Library:Create("Frame", {
                Parent = Items.Inline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local tbGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.Background,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(tbGrad, "Selected")

            Items.Input = Library:Create("TextBox", {
                FontFace = Library.Font,
                ClearTextOnFocus = false,
                PlaceholderColor3 = rgb(140, 140, 140),
                PlaceholderText = Cfg.PlaceHolder,
                TextSize = 12,
                TextTruncate = Enum.TextTruncate.AtEnd,
                Size = dim2(1, -8, 1, 0),
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = Cfg.Default,
                Parent = Items.Background,
                TextXAlignment = Enum.TextXAlignment.Left,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 4, 0, 0),
                CursorPosition = -1,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Input, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Input,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            function Cfg.Set(text)
                Flags[Cfg.Flag] = text
                Items.Input.Text = text
                
                task.spawn(function()
                    Cfg.Callback(text)
                end)
            end

            Items.Input:GetPropertyChangedSignal("Text"):Connect(function()
                Flags[Cfg.Flag] = Items.Input.Text
                task.spawn(function()
                    Cfg.Callback(Items.Input.Text)
                end)
            end)

            ConfigFlags[Cfg.Flag] = Cfg.Set

            return setmetatable(Cfg, Library)
        end

        function Library:Keybind(properties)
            local Cfg = {
                Flag = properties.Flag or properties.Name or "Keybind",
                Callback = properties.Callback or function() end,
                Name = properties.Name or nil,
                Key = properties.Key or Enum.KeyCode.Insert,
                Mode = properties.Mode or "Toggle",
                Active = properties.Default or false,
                Show = properties.ShowInList ~= false,
                Open = false,
                Binding = nil,
                Items = {}
            }

            Flags[Cfg.Flag] = {
                Mode = Cfg.Mode,
                Key = Cfg.Key,
                Active = Cfg.Active
            }

            local Items = Cfg.Items

            -- Keybind button
            Items.KeybindOuter = Library:Create("TextButton", {
                                Parent = self.Items.Components,
                AutoButtonColor = false,
                Text = "",
                Name = "\0",
                Size = dim2(0, 0, 0, 12),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.X,
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.KeybindOuter, "border_dark", "BackgroundColor3")

            Items.KeybindOutline = Library:Create("Frame", {
                Parent = Items.KeybindOuter,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.X,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.KeybindOutline, "outline", "BackgroundColor3")

            Items.KeybindInline = Library:Create("Frame", {
                Parent = Items.KeybindOutline,
                Size = dim2(1, -2, 1, -2),
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.X,
                BackgroundColor3 = themes.preset.background
            })
            Library:Themify(Items.KeybindInline, "background", "BackgroundColor3")

            Items.Key = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = "INS",
                Parent = Items.KeybindInline,
                BackgroundTransparency = 1,
                Name = "\0",
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.Key, "text_color", "TextColor3")
            
            Library:Create("UIStroke", {
                Parent = Items.Key,
                LineJoinMode = Enum.LineJoinMode.Miter
            })
            
            Library:Create("UIPadding", {
                Parent = Items.Key,
                PaddingTop = dim(0, -2),
                PaddingRight = dim(0, 4),
                PaddingLeft = dim(0, 4)
            })

            -- Mode selector popup
            Items.ModeHolder = Library:Create("Frame", {
                Parent = Library.Other,
                Size = dim2(0, 120, 0, 0),
                Name = "\0",
                Visible = false,
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.border_dark,
                ZIndex = 100
            })
            Library:Themify(Items.ModeHolder, "border_dark", "BackgroundColor3")

            Items.ModeOuterBorder = Library:Create("Frame", {
                Parent = Items.ModeHolder,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.outline,
                ZIndex = 100
            })
            Library:Themify(Items.ModeOuterBorder, "outline", "BackgroundColor3")

            Items.ModeAccent = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.ModeOuterBorder,
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 2),
                BackgroundColor3 = themes.preset.accent,
                ZIndex = 101
            })
            Library:Themify(Items.ModeAccent, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.ModeAccent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            Items.ModeSeparator = Library:Create("Frame", {
                Parent = Items.ModeOuterBorder,
                Name = "\0",
                Position = dim2(0, 0, 0, 3),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 1),
                BackgroundColor3 = themes.preset.outline,
                ZIndex = 101
            })
            Library:Themify(Items.ModeSeparator, "outline", "BackgroundColor3")

            Items.ModeInline = Library:Create("Frame", {
                Parent = Items.ModeOuterBorder,
                Name = "\0",
                Position = dim2(0, 1, 0, 4),
                Size = dim2(1, -2, 1, -5),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 100
            })
            
            local modeGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.ModeInline,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(modeGrad, "Selected")

            Items.ModeFade = Library:Create("Frame", {
                Parent = Items.ModeHolder,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 1, -2),
                BackgroundColor3 = themes.preset.gradient,
                ZIndex = 105
            })
            Library:Themify(Items.ModeFade, "gradient", "BackgroundColor3")

            Items.ModeElements = Library:Create("Frame", {
                BorderSizePixel = 0,
                Parent = Items.ModeInline,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 4, 0, 4),
                Size = dim2(1, -8, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 101
            })
            
            Library:Create("UIListLayout", {
                Parent = Items.ModeElements,
                Padding = dim(0, 4),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            Library:Create("UIPadding", {
                PaddingBottom = dim(0, 4),
                Parent = Items.ModeElements
            })

            -- Create mode dropdown inside the popup
            local ModeParent = setmetatable({Items = {Elements = Items.ModeElements, GroupElements = Items.ModeElements, Components = Items.ModeElements}}, Library)
            Items.ModeDropdown = ModeParent:Dropdown({
                Name = "Mode",
                Options = {"Hold", "Toggle", "Always"},
                Flag = Cfg.Flag .. "_MODE_SETTING",
                Default = Cfg.Mode,
                Callback = function(option)
                    if Cfg.SetMode then
                        Cfg.SetMode(option)
                    end
                end
            })

            -- Keybind list entry (if ShowInList is true)
            if Cfg.Show then
                Items.KeybindEntry = Library:Create("TextLabel", {
                    FontFace = Library.Font,
                    TextColor3 = themes.preset.text_color,
                    BorderSizePixel = 0,
                    Parent = Library.KeybindParent,
                    Name = "\0",
                    AutomaticSize = Enum.AutomaticSize.XY,
                    BackgroundTransparency = 1,
                    RichText = true,
                    Visible = false,
                    ZIndex = 2,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                Library:Themify(Items.KeybindEntry, "text_color", "TextColor3")
                
                Library:Create("UIStroke", {
                    Parent = Items.KeybindEntry,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })
            end

            function Cfg.SetMode(mode)
                Cfg.Mode = mode
                Flags[Cfg.Flag].Mode = mode

                if mode == "Always" then
                    Cfg.Active = true
                    Cfg.Set(true)
                elseif mode == "Hold" then
                    Cfg.Active = false
                    Cfg.Set(false)
                end
            end

            function Cfg.Set(input)
                -- Handle boolean input (active state)
                if type(input) == "boolean" then
                    Cfg.Active = input

                    if Cfg.Mode == "Always" then
                        Cfg.Active = true
                    end

                -- Handle Enum input (key change)
                elseif typeof(input) == "EnumItem" then
                    if input == Enum.KeyCode.Escape then
                        Cfg.Key = "NONE"
                    else
                        Cfg.Key = input
                    end

                -- Handle string input (mode change)
                elseif type(input) == "string" and table.find({"Toggle", "Hold", "Always"}, input) then
                    Cfg.SetMode(input)
                    return

                -- Handle table input (full config)
                elseif type(input) == "table" then
                    if input.Key then
                        if type(input.Key) == "string" then
                            if input.Key == "NONE" then
                                Cfg.Key = "NONE"
                            else
                                local converted = Library:ConvertEnum(input.Key)
                                Cfg.Key = converted or "NONE"
                            end
                        else
                            Cfg.Key = input.Key == Enum.KeyCode.Escape and "NONE" or input.Key
                        end
                    end

                    if input.Mode then
                        Cfg.Mode = input.Mode
                    end

                    if input.Active ~= nil then
                        Cfg.Active = input.Active
                    end

                    if Cfg.Mode == "Always" then
                        Cfg.Active = true
                    end

                    -- Update mode dropdown
                    if Items.ModeDropdown then
                        Items.ModeDropdown.Set(Cfg.Mode)
                    end
                end

                -- Update key display text
                local keyText = "NONE"
                if Cfg.Key and Cfg.Key ~= "NONE" then
                    keyText = Keys[Cfg.Key] or tostring(Cfg.Key):gsub("Enum.KeyCode.", ""):gsub("Enum.UserInputType.", "")
                end
                Items.Key.Text = keyText

                -- Update keybind list entry
                if Items.KeybindEntry then
                    Items.KeybindEntry.Visible = Cfg.Active
                    Items.KeybindEntry.Text = string.format("[%s] %s", keyText, Cfg.Name or Cfg.Flag)
                end

                -- Update flags
                Flags[Cfg.Flag] = {
                    Mode = Cfg.Mode,
                    Key = Cfg.Key,
                    Active = Cfg.Active
                }

                -- Fire callback only for active state changes
                if type(input) == "boolean" or (type(input) == "table" and input.Active ~= nil) then
                    task.spawn(function()
                        Cfg.Callback(Cfg.Active)
                    end)
                end
            end

            function Cfg.SetVisible(bool)
                Items.ModeFade.BackgroundTransparency = 0
                Library:Tween(Items.ModeFade, {BackgroundTransparency = 1})

                Items.ModeHolder.Visible = bool
                Items.ModeHolder.Parent = bool and Library.Items or Library.Other

                if bool then
                    local xPos = Items.KeybindOuter.AbsolutePosition.X
                    local yPos = Items.KeybindOuter.AbsolutePosition.Y + 18

                    -- Keep within screen bounds
                    if xPos + 120 > Camera.ViewportSize.X then
                        xPos = Camera.ViewportSize.X - 130
                    end
                    if yPos + 80 > Camera.ViewportSize.Y then
                        yPos = Items.KeybindOuter.AbsolutePosition.Y - 85
                    end

                    Items.ModeHolder.Position = dim2(0, xPos, 0, yPos)
                end
            end

            -- Left click to bind key
            Items.KeybindOuter.MouseButton1Down:Connect(function()
                Items.Key.Text = "..."

                if Cfg.Binding then
                    Cfg.Binding:Disconnect()
                end

                Cfg.Binding = Library:Connection(InputService.InputBegan, function(input, gameProcessed)
                    local key = input.KeyCode ~= Enum.KeyCode.Unknown and input.KeyCode or input.UserInputType
                    Cfg.Set(key)

                    if Cfg.Binding then
                        Cfg.Binding:Disconnect()
                        Cfg.Binding = nil
                    end
                end)
            end)

            -- Right click to open mode selector
            Items.KeybindOuter.MouseButton2Down:Connect(function()
                Cfg.Open = not Cfg.Open
                Cfg.SetVisible(Cfg.Open)
            end)

            -- Close mode selector when clicking outside
            Library:Connection(InputService.InputBegan, function(input, gameProcessed)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    if Items.ModeHolder.Visible then
                        local hovering = Library:Hovering({
                            Items.ModeHolder,
                            Items.ModeDropdown and Items.ModeDropdown.Items.DropdownElements or nil
                        })

                        if not hovering then
                            if Items.ModeDropdown then
                                Items.ModeDropdown.SetVisible(false)
                                Items.ModeDropdown.Open = false
                            end
                            Cfg.SetVisible(false)
                            Cfg.Open = false
                        end
                    end
                end

                -- Handle keybind activation
                if not gameProcessed and Cfg.Key and Cfg.Key ~= "NONE" then
                    local pressedKey = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType

                    if pressedKey == Cfg.Key then
                        if Cfg.Mode == "Toggle" then
                            Cfg.Set(not Cfg.Active)
                        elseif Cfg.Mode == "Hold" then
                            Cfg.Set(true)
                        end
                    end
                end
            end)

            -- Handle hold mode release
            Library:Connection(InputService.InputEnded, function(input, gameProcessed)
                if gameProcessed then return end
                if not Cfg.Key or Cfg.Key == "NONE" then return end

                local releasedKey = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType

                if releasedKey == Cfg.Key and Cfg.Mode == "Hold" then
                    Cfg.Set(false)
                end
            end)

            -- Initialize
            Cfg.Set({Mode = Cfg.Mode, Active = Cfg.Active, Key = Cfg.Key})
            ConfigFlags[Cfg.Flag] = Cfg.Set

            return setmetatable(Cfg, Library)
        end

        function Library:MultiSection(properties)
            local Cfg = {
                Tabs = properties.Tabs or {"Tab1", "Tab2", "Tab3"},
                Side = properties.Side or properties.side or "Left",
                Size = properties.Size or properties.size or nil,
                Items = {},
                Store = {},
                TabInfo = nil
            }

            local Items = Cfg.Items

            -- Section container
            Items.Section = Library:Create("Frame", {
                Parent = self.Items[Cfg.Side],
                Name = "\0",
                Size = dim2(1, 0, Cfg.Size or 0, 0),
                BorderSizePixel = 0,
                AutomaticSize = Cfg.Size and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.shadow
            })
            Library:Themify(Items.Section, "shadow", "BackgroundColor3")

            Items.SectionOuter = Library:Create("Frame", {
                Parent = Items.Section,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                AutomaticSize = Cfg.Size and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.SectionOuter, "border_dark", "BackgroundColor3")

            Items.SectionInner = Library:Create("Frame", {
                Parent = Items.SectionOuter,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                AutomaticSize = Cfg.Size and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.SectionInner, "outline", "BackgroundColor3")

            -- Tab buttons container
            Items.TabButtons = Library:Create("Frame", {
                Parent = Items.SectionInner,
                Name = "\0",
                ZIndex = 2,
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 24),
                BackgroundColor3 = rgb(255, 255, 255)
            })

            Items.TabAccent = Library:Create("Frame", {
                Name = "\0",
                ZIndex = 2,
                Parent = Items.TabButtons,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 2),
                BackgroundColor3 = themes.preset.accent
            })
            Library:Themify(Items.TabAccent, "accent", "BackgroundColor3")
            
            Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TabAccent,
                Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
            })

            Items.TabSeparator = Library:Create("Frame", {
                Parent = Items.TabButtons,
                Name = "\0",
                ZIndex = 2,
                Position = dim2(0, 0, 0, 2),
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 1),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.TabSeparator, "outline", "BackgroundColor3")

            local tabGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TabButtons,
                Color = rgbseq{rgbkey(0, themes.preset.gradient), rgbkey(1, themes.preset.background)}
            })
            Library:SaveGradient(tabGrad, "Deselected")

            Items.Buttons = Library:Create("Frame", {
                Parent = Items.TabButtons,
                BackgroundTransparency = 1,
                ZIndex = 3,
                Name = "\0",
                BorderSizePixel = 0,
                Size = dim2(1, 0, 1, -1),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            Library:Create("UIListLayout", {
                Parent = Items.Buttons,
                FillDirection = Enum.FillDirection.Horizontal,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = dim(0, -1)
            })
            
            Library:Create("UIPadding", {
                Parent = Items.Buttons,
                PaddingTop = dim(0, 3)
            })

            Items.TabBottomOutline = Library:Create("Frame", {
                BorderSizePixel = 0,
                AnchorPoint = vec2(0, 1),
                Parent = Items.TabButtons,
                Name = "\0",
                Position = dim2(0, 0, 1, 0),
                Size = dim2(1, 0, 0, 1),
                ZIndex = 3,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.TabBottomOutline, "outline", "BackgroundColor3")

            -- Content inline
            Items.Inline = Library:Create("Frame", {
                Parent = Items.SectionInner,
                Size = dim2(1, -2, Cfg.Size and 1 or 0, Cfg.Size and -6 or 0),
                Name = "\0",
                Position = dim2(0, 1, 0, 4),
                BorderSizePixel = 0,
                AutomaticSize = Cfg.Size and Enum.AutomaticSize.None or Enum.AutomaticSize.Y,
                BackgroundColor3 = themes.preset.gradient
            })
            Library:Themify(Items.Inline, "gradient", "BackgroundColor3")
            
            Library:Create("UIPadding", {
                PaddingBottom = dim(0, 6),
                Parent = Items.Inline
            })

            Items.Fade = Library:Create("Frame", {
                Parent = Items.Inline,
                Size = dim2(1, 0, 1, -26),
                Name = "\0",
                Position = dim2(0, 0, 0, 26),
                BorderSizePixel = 0,
                ZIndex = 2,
                BackgroundTransparency = 1,
                BackgroundColor3 = themes.preset.gradient
            })
            Library:Themify(Items.Fade, "gradient", "BackgroundColor3")

            -- Title gradient
            Items.TitleGradient = Library:Create("Frame", {
                Parent = Items.Inline,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                BorderSizePixel = 0,
                Size = dim2(1, -2, 0, 18),
                BackgroundColor3 = rgb(255, 255, 255)
            })
            
            local titleGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.TitleGradient,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(titleGrad, "Selected")

            -- Elements container
            Items.Elements = Library:Create("Frame", {
                BorderSizePixel = 0,
                Parent = Items.Inline,
                Name = "\0",
                Visible = true,
                BackgroundTransparency = 1,
                Position = dim2(0, 8, 0, 28),
                Size = dim2(1, -16, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            Library:Create("UIListLayout", {
                Parent = Items.Elements,
                Padding = dim(0, 5),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            -- Scrolling frame
            Items.ScrollingFrame = Library:Create("ScrollingFrame", {
                Active = true,
                ScrollingEnabled = true,
                AutomaticCanvasSize = Enum.AutomaticSize.Y,
                ZIndex = 2,
                BorderSizePixel = 0,
                CanvasSize = dim2(0, 0, 0, 0),
                ScrollBarImageColor3 = themes.preset.accent,
                MidImage = "rbxassetid://120496541810421",
                BorderColor3 = rgb(0, 0, 0),
                ScrollBarThickness = 0,
                Parent = Items.Inline,
                Size = dim2(1, -4, 1, -28),
                TopImage = "rbxassetid://118750478739322",
                Position = dim2(0, 0, 0, 26),
                BottomImage = "rbxassetid://74268315755026",
                BackgroundTransparency = 1,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.ScrollingFrame, "accent", "ScrollBarImageColor3")

            Items.ScrollingLine = Library:Create("Frame", {
                Visible = false,
                BorderSizePixel = 0,
                AnchorPoint = vec2(1, 0),
                Name = "\0",
                Position = dim2(1, -3, 0, 26),
                Parent = Items.Inline,
                Size = dim2(0, 3, 1, -28),
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.ScrollingLine, "outline", "BackgroundColor3")

            Items.Elements:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
                if Items.ScrollingFrame.AbsoluteSize.Y < Items.Elements.AbsoluteSize.Y then
                    Items.ScrollingLine.Visible = true
                    Library:Tween(Items.ScrollingFrame, {ScrollBarThickness = 2})
                    Library:Tween(Items.Elements, {Size = dim2(1, -18, 0, 0)})
                else
                    Items.ScrollingLine.Visible = false
                    Library:Tween(Items.ScrollingFrame, {ScrollBarThickness = 0})
                    Library:Tween(Items.Elements, {Size = dim2(1, -14, 0, 0)})
                end
            end)

            Items.Elements.Parent = Items.ScrollingFrame
            Items.Elements.Position = dim2(0, 8, 0, 2)

            -- Create tabs
            for idx, tabName in ipairs(Cfg.Tabs) do
                local TabData = {Items = {}}
                local SubItems = TabData.Items

                SubItems.Button = Library:Create("TextButton", {
                    Parent = Items.Buttons,
                    Name = "\0",
                    ZIndex = 4,
                    Size = dim2(0, 0, 1, 0),
                    BorderSizePixel = 0,
                    Text = "",
                    AutomaticSize = Enum.AutomaticSize.X,
                    AutoButtonColor = false,
                    BackgroundColor3 = rgb(255, 255, 255)
                })

                SubItems.Background = Library:Create("TextLabel", {
                    FontFace = Library.Font,
                    TextColor3 = themes.preset.text_color,
                    BorderSizePixel = 0,
                    Text = tabName,
                    ZIndex = 4,
                    Parent = SubItems.Button,
                    Name = "\0",
                    BackgroundTransparency = (not Cfg.TabInfo) and 1 or 0,
                    Size = dim2(0, 0, 1, 0),
                    AutomaticSize = Enum.AutomaticSize.XY,
                    TextSize = 12,
                    BackgroundColor3 = themes.preset.tab_background
                })
                Library:Themify(SubItems.Background, "tab_background", "BackgroundColor3")

                SubItems.TextPadding = Library:Create("UIPadding", {
                    Parent = SubItems.Background,
                    PaddingRight = dim(0, (not Cfg.TabInfo) and 10 or 8),
                    PaddingLeft = dim(0, 6)
                })

                Library:Create("UIStroke", {
                    Parent = SubItems.Background,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })

                SubItems.Fill = Library:Create("Frame", {
                    BorderSizePixel = 0,
                    AnchorPoint = vec2(0, 1),
                    Parent = SubItems.Button,
                    ZIndex = 5,
                    Name = "\0",
                    Position = dim2(0, 0, 1, 1),
                    Size = dim2(1, 0, 0, 1),
                    BackgroundTransparency = (not Cfg.TabInfo) and 0 or 1,
                    BackgroundColor3 = themes.preset.gradient
                })
                Library:Themify(SubItems.Fill, "gradient", "BackgroundColor3")

                local btnGrad = Library:Create("UIGradient", {
                    Rotation = 90,
                    Parent = SubItems.Button,
                    Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
                })
                Library:SaveGradient(btnGrad, "Selected")

                SubItems.UIStroke = Library:Create("UIStroke", {
                    Color = themes.preset.outline,
                    LineJoinMode = Enum.LineJoinMode.Miter,
                    Parent = SubItems.Button,
                    ApplyStrokeMode = Enum.ApplyStrokeMode.Border
                })
                Library:Themify(SubItems.UIStroke, "outline", "Color")

                SubItems.Elements = Library:Create("Frame", {
                    BorderSizePixel = 0,
                    Parent = Library.Other,
                    Name = "\0",
                    Visible = false,
                    BackgroundTransparency = 1,
                    Position = dim2(0, 0, 0, 0),
                    Size = dim2(1, 0, 0, 0),
                    AutomaticSize = Enum.AutomaticSize.Y,
                    BackgroundColor3 = rgb(255, 255, 255)
                })

                Library:Create("UIListLayout", {
                    Parent = SubItems.Elements,
                    Padding = dim(0, 5),
                    SortOrder = Enum.SortOrder.LayoutOrder
                })

                function TabData.OpenTab()
                    local Cache = Cfg.TabInfo

                    if Cache then
                        Items.Fade.BackgroundTransparency = 0
                        Library:Tween(Items.Fade, {BackgroundTransparency = 1})
                        Library:Tween(Cache.Fill, {BackgroundTransparency = 1})
                        Library:Tween(Cache.Background, {BackgroundTransparency = 0})

                        Cache.Elements.Visible = false
                        Cache.Elements.Parent = Library.Other
                    end

                    Library:Tween(SubItems.Fill, {BackgroundTransparency = 0})
                    Library:Tween(SubItems.Background, {BackgroundTransparency = 1})

                    SubItems.Elements.Parent = Items.Elements
                    SubItems.Elements.Visible = true

                    Cfg.TabInfo = SubItems
                end

                SubItems.Button.MouseButton1Click:Connect(function()
                    TabData.OpenTab()
                end)

                if not Cfg.TabInfo then
                    TabData.OpenTab()
                end

                Cfg.Store[#Cfg.Store + 1] = setmetatable(TabData, Library)
            end

            return unpack(Cfg.Store)
        end

        function Library:PlayerList(properties)
            local Cfg = {
                Players = {},
                Items = {},
                Selected = nil
            }

            local Colors = {
                ["Neutral"] = themes.preset.text_color,
                ["Friendly"] = rgb(50, 150, 80),
                ["Enemy"] = rgb(200, 60, 60)
            }

            -- Remove left/right columns for player list
            if self.Items.Left then
                self.Items.Left:Destroy()
            end
            if self.Items.Right then
                self.Items.Right:Destroy()
            end

            local Items = Cfg.Items

            -- Main container
            Items.Container = Library:Create("Frame", {
                Parent = self.Items.Page,
                BackgroundTransparency = 1,
                Name = "\0",
                BorderSizePixel = 0,
                Size = dim2(1, 0, 1, 0),
                BackgroundColor3 = rgb(255, 255, 255)
            })

            Library:Create("UIListLayout", {
                Parent = Items.Container,
                Padding = dim(0, 6),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            -- Player list section
            Items.ListSection = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.Container,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 1, -90),
                BackgroundColor3 = themes.preset.shadow
            })
            Library:Themify(Items.ListSection, "shadow", "BackgroundColor3")

            Items.ListOuter = Library:Create("Frame", {
                Parent = Items.ListSection,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.ListOuter, "border_dark", "BackgroundColor3")

            Items.ListInner = Library:Create("Frame", {
                Parent = Items.ListOuter,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.ListInner, "outline", "BackgroundColor3")

            -- Search bar
            Items.SearchHolder = Library:Create("Frame", {
                BorderSizePixel = 0,
                Parent = Items.ListInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -62, 0, 22),
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.SearchHolder, "inline", "BackgroundColor3")

            Items.SearchBackground = Library:Create("Frame", {
                Parent = Items.SearchHolder,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local searchGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.SearchBackground,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(searchGrad, "Selected")

            Items.Search = Library:Create("TextBox", {
                BorderSizePixel = 0,
                Parent = Items.SearchBackground,
                Name = "\0",
                Position = dim2(0, 6, 0, 0),
                Size = dim2(1, -12, 1, 0),
                FontFace = Library.Font,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextColor3 = themes.preset.text_color,
                BackgroundTransparency = 1,
                Text = "",
                TextSize = 12,
                PlaceholderText = "Search players...",
                PlaceholderColor3 = rgb(120, 120, 120),
                ClearTextOnFocus = false
            })
            Library:Themify(Items.Search, "text_color", "TextColor3")

            Library:Create("UIStroke", {
                Parent = Items.Search,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Refresh button
            Items.RefreshButton = Library:Create("TextButton", {
                BorderSizePixel = 0,
                AnchorPoint = vec2(1, 0),
                Parent = Items.ListInner,
                Name = "\0",
                Position = dim2(1, -1, 0, 1),
                Size = dim2(0, 60, 0, 22),
                Text = "",
                AutoButtonColor = false,
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.RefreshButton, "inline", "BackgroundColor3")

            Items.RefreshBackground = Library:Create("Frame", {
                Parent = Items.RefreshButton,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local refreshGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.RefreshBackground,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(refreshGrad, "Selected")

            Items.RefreshText = Library:Create("TextLabel", {
                FontFace = Library.Font,
                TextColor3 = themes.preset.text_color,
                BorderSizePixel = 0,
                Text = "Refresh",
                Parent = Items.RefreshBackground,
                Name = "\0",
                Size = dim2(1, 0, 1, 0),
                BackgroundTransparency = 1,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            Library:Themify(Items.RefreshText, "text_color", "TextColor3")

            Library:Create("UIStroke", {
                Parent = Items.RefreshText,
                LineJoinMode = Enum.LineJoinMode.Miter
            })

            -- Column headers
            Items.Headers = Library:Create("Frame", {
                Parent = Items.ListInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 24),
                Size = dim2(1, -2, 0, 20),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.inline
            })
            Library:Themify(Items.Headers, "inline", "BackgroundColor3")

            Items.HeaderBackground = Library:Create("Frame", {
                Parent = Items.Headers,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            local headerGrad = Library:Create("UIGradient", {
                Rotation = 90,
                Parent = Items.HeaderBackground,
                Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
            })
            Library:SaveGradient(headerGrad, "Selected")

            Library:Create("UIListLayout", {
                FillDirection = Enum.FillDirection.Horizontal,
                HorizontalFlex = Enum.UIFlexAlignment.Fill,
                Parent = Items.HeaderBackground,
                SortOrder = Enum.SortOrder.LayoutOrder,
                VerticalFlex = Enum.UIFlexAlignment.Fill
            })

            -- Header labels
            for _, header in ipairs({"Name", "UserId", "Priority"}) do
                local label = Library:Create("TextLabel", {
                    FontFace = Library.Font,
                    TextColor3 = themes.preset.text_color,
                    BorderSizePixel = 0,
                    Text = header,
                    Parent = Items.HeaderBackground,
                    Name = "\0",
                    BackgroundTransparency = 1,
                    Size = dim2(1, 0, 1, 0),
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                Library:Themify(label, "text_color", "TextColor3")

                Library:Create("UIStroke", {
                    Parent = label,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })
            end

            -- Player scroll list
            Items.PlayerScroll = Library:Create("ScrollingFrame", {
                ScrollBarImageColor3 = themes.preset.accent,
                MidImage = "rbxassetid://74268315755026",
                Active = true,
                AutomaticCanvasSize = Enum.AutomaticSize.Y,
                ScrollBarThickness = 3,
                Parent = Items.ListInner,
                Size = dim2(1, -4, 1, -46),
                BorderSizePixel = 0,
                TopImage = "rbxassetid://74268315755026",
                Position = dim2(0, 2, 0, 45),
                BackgroundTransparency = 1,
                BottomImage = "rbxassetid://74268315755026",
                CanvasSize = dim2(0, 0, 0, 0)
            })
            Library:Themify(Items.PlayerScroll, "accent", "ScrollBarImageColor3")

            Library:Create("UIListLayout", {
                Parent = Items.PlayerScroll,
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            -- Selected player info section
            Items.InfoSection = Library:Create("Frame", {
                Name = "\0",
                Parent = Items.Container,
                BorderSizePixel = 0,
                Size = dim2(1, 0, 0, 84),
                BackgroundColor3 = themes.preset.shadow
            })
            Library:Themify(Items.InfoSection, "shadow", "BackgroundColor3")

            Items.InfoOuter = Library:Create("Frame", {
                Parent = Items.InfoSection,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.border_dark
            })
            Library:Themify(Items.InfoOuter, "border_dark", "BackgroundColor3")

            Items.InfoInner = Library:Create("Frame", {
                Parent = Items.InfoOuter,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.outline
            })
            Library:Themify(Items.InfoInner, "outline", "BackgroundColor3")

            Items.InfoContent = Library:Create("Frame", {
                Parent = Items.InfoInner,
                Name = "\0",
                Position = dim2(0, 1, 0, 1),
                Size = dim2(1, -2, 1, -2),
                BorderSizePixel = 0,
                BackgroundColor3 = themes.preset.gradient
            })
            Library:Themify(Items.InfoContent, "gradient", "BackgroundColor3")

            -- Avatar
            Items.Avatar = Library:Create("ImageLabel", {
                BorderSizePixel = 0,
                Parent = Items.InfoContent,
                Name = "\0",
                AnchorPoint = vec2(0, 0.5),
                Image = "",
                BackgroundColor3 = themes.preset.inline,
                Position = dim2(0, 8, 0.5, 0),
                Size = dim2(0, 60, 0, 60),
            })
            Library:Themify(Items.Avatar, "inline", "BackgroundColor3")

            -- Info labels
            Items.InfoLabels = Library:Create("Frame", {
                Parent = Items.InfoContent,
                Name = "\0",
                BackgroundTransparency = 1,
                Position = dim2(0, 76, 0, 6),
                BorderSizePixel = 0,
                Size = dim2(0, 140, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            Library:Create("UIListLayout", {
                Parent = Items.InfoLabels,
                Padding = dim(0, 2),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            local InfoParent = setmetatable({Items = {Elements = Items.InfoLabels, GroupElements = Items.InfoLabels, Components = Items.InfoLabels}}, Library)
            Items.NameLabel = InfoParent:Label({Name = "Name: ---"})
            Items.DisplayLabel = InfoParent:Label({Name = "Display: ---"})
            Items.UserIdLabel = InfoParent:Label({Name = "UserId: ---"})

            -- Priority dropdown
            Items.PriorityHolder = Library:Create("Frame", {
                BorderSizePixel = 0,
                AnchorPoint = vec2(1, 0),
                Parent = Items.InfoContent,
                BackgroundTransparency = 1,
                Position = dim2(1, -8, 0, 8),
                Name = "\0",
                Size = dim2(0, 120, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255)
            })

            Library:Create("UIListLayout", {
                Parent = Items.PriorityHolder,
                Padding = dim(0, 4),
                SortOrder = Enum.SortOrder.LayoutOrder
            })

            local PriorityParent = setmetatable({Items = {Elements = Items.PriorityHolder, GroupElements = Items.PriorityHolder, Components = Items.PriorityHolder}}, Library)
            Items.PriorityDropdown = PriorityParent:Dropdown({
                Name = "Priority",
                Options = {"Neutral", "Friendly", "Enemy"},
                Default = "Neutral",
                Callback = function(option)
                    if Cfg.Selected then
                        Cfg.ModifyPriority(option)
                    end
                end
            })

            function Cfg.AddPlayer(player)
                local PlayerData = {}

                PlayerData.Row = Library:Create("TextButton", {
                    BorderSizePixel = 0,
                    Parent = Items.PlayerScroll,
                    Name = "\0",
                    Size = dim2(1, -4, 0, 22),
                    BackgroundTransparency = 1,
                    Position = dim2(0, 2, 0, 0),
                    Text = "",
                    AutoButtonColor = false,
                    BackgroundColor3 = rgb(255, 255, 255)
                })

                local rowGrad = Library:Create("UIGradient", {
                    Rotation = 90,
                    Parent = PlayerData.Row,
                    Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
                })
                Library:SaveGradient(rowGrad, "Selected")

                Library:Create("UIListLayout", {
                    FillDirection = Enum.FillDirection.Horizontal,
                    HorizontalFlex = Enum.UIFlexAlignment.Fill,
                    Parent = PlayerData.Row,
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    VerticalFlex = Enum.UIFlexAlignment.Fill
                })

                PlayerData.NameLabel = Library:Create("TextLabel", {
                    FontFace = Library.Font,
                    TextColor3 = themes.preset.text_color,
                    BorderSizePixel = 0,
                    Text = player.Name,
                    Parent = PlayerData.Row,
                    Name = "\0",
                    Size = dim2(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                Library:Themify(PlayerData.NameLabel, "text_color", "TextColor3")

                Library:Create("UIStroke", {
                    Parent = PlayerData.NameLabel,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })

                Library:Create("UIPadding", {
                    PaddingLeft = dim(0, 6),
                    Parent = PlayerData.NameLabel
                })

                PlayerData.UserIdLabel = Library:Create("TextLabel", {
                    FontFace = Library.Font,
                    TextColor3 = themes.preset.text_color,
                    BorderSizePixel = 0,
                    Text = tostring(player.UserId),
                    Parent = PlayerData.Row,
                    Name = "\0",
                    BackgroundTransparency = 1,
                    Size = dim2(1, 0, 1, 0),
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                })
                Library:Themify(PlayerData.UserIdLabel, "text_color", "TextColor3")

                Library:Create("UIStroke", {
                    Parent = PlayerData.UserIdLabel,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })

                local isLocal = player == Players.LocalPlayer
                PlayerData.PriorityLabel = Library:Create("TextLabel", {
                    FontFace = Library.Font,
                    TextColor3 = isLocal and rgb(100, 100, 100) or themes.preset.text_color,
                    BorderSizePixel = 0,
                    Text = isLocal and "Local" or "Neutral",
                    Parent = PlayerData.Row,
                    Name = "\0",
                    Size = dim2(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    TextXAlignment = Enum.TextXAlignment.Right,
                    TextSize = 12,
                    BackgroundColor3 = rgb(255, 255, 255)
                })

                Library:Create("UIStroke", {
                    Parent = PlayerData.PriorityLabel,
                    LineJoinMode = Enum.LineJoinMode.Miter
                })

                Library:Create("UIPadding", {
                    PaddingRight = dim(0, 8),
                    Parent = PlayerData.PriorityLabel
                })

                PlayerData.Row.MouseButton1Click:Connect(function()
                    if isLocal then return end

                    -- Deselect previous
                    if Cfg.Selected then
                        Cfg.Selected.NameLabel.TextColor3 = themes.preset.text_color
                        Cfg.Selected.UserIdLabel.TextColor3 = themes.preset.text_color
                    end

                    -- Select new
                    PlayerData.NameLabel.TextColor3 = themes.preset.accent
                    PlayerData.UserIdLabel.TextColor3 = themes.preset.accent

                    -- Update info panel
                    pcall(function()
                        Items.Avatar.Image = Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.AvatarThumbnail, Enum.ThumbnailSize.Size150x150)
                    end)

                    Items.NameLabel.Set("Name: " .. player.Name)
                    Items.DisplayLabel.Set("Display: " .. player.DisplayName)
                    Items.UserIdLabel.Set("UserId: " .. tostring(player.UserId))

                    Cfg.Selected = PlayerData

                    task.wait()
                    Items.PriorityDropdown.Set(PlayerData.PriorityLabel.Text)
                end)

                Cfg.Players[player.Name] = PlayerData
            end

            function Cfg.ModifyPriority(priority, playerData)
                local target = playerData or Cfg.Selected
                if target then
                    target.PriorityLabel.Text = priority
                    target.PriorityLabel.TextColor3 = Colors[priority] or themes.preset.text_color
                end
            end

            function Cfg.GetPriority(playerName)
                if Cfg.Players[playerName] then
                    return Cfg.Players[playerName].PriorityLabel.Text
                end
                return "Neutral"
            end

            -- Add existing players
            for _, player in ipairs(Players:GetPlayers()) do
                Cfg.AddPlayer(player)
            end

            -- Refresh button
            Items.RefreshButton.MouseButton1Click:Connect(function()
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= Players.LocalPlayer and Cfg.Players[player.Name] then
                        Cfg.ModifyPriority("Neutral", Cfg.Players[player.Name])
                    end
                end
            end)

            -- Search functionality
            Items.Search:GetPropertyChangedSignal("Text"):Connect(function()
                local searchText = Items.Search.Text:lower()

                for _, player in ipairs(Players:GetPlayers()) do
                    local data = Cfg.Players[player.Name]
                    if data then
                        data.Row.Visible = player.Name:lower():find(searchText) ~= nil
                    end
                end
            end)

            -- Player events
            Players.PlayerAdded:Connect(function(player)
                Cfg.AddPlayer(player)
            end)

            Players.PlayerRemoving:Connect(function(player)
                if Cfg.Players[player.Name] then
                    Cfg.Players[player.Name].Row:Destroy()
                    Cfg.Players[player.Name] = nil
                end
            end)

            return setmetatable(Cfg, Library)
        end

        function Library:Configs(window)
            local ConfigText = ""

            local Tab = window:Tab({Name = "Settings"})

            -- Config section
            local ConfigSection = Tab:Section({Name = "Configuration", Side = "Left"})

            ConfigHolder = ConfigSection:Dropdown({
                Name = "Configs",
                Options = {},
                Default = "",
                Callback = function(option)
                    if option and option ~= "" then
                        ConfigText = option
                    end
                end,
                Flag = "config_list"
            })
            Library:UpdateConfigList()

            ConfigSection:Textbox({
                Name = "Config Name",
                Flag = "config_name",
                Default = "",
                PlaceHolder = "Enter config name...",
                Callback = function(text)
                    if text then
                        ConfigText = text
                    end
                end
            })

            ConfigSection:Button({
                Name = "Save Config",
                Callback = function()
                    if ConfigText and ConfigText ~= "" then
                        pcall(function()
                            writefile(Library.Directory .. "/configs/" .. ConfigText .. ".cfg", Library:GetConfig())
                            Library:UpdateConfigList()
                            Notifications:Create({Name = "Saved: " .. ConfigText, LifeTime = 3})
                        end)
                    else
                        Notifications:Create({Name = "Enter a config name!", LifeTime = 3})
                    end
                end
            })

            ConfigSection:Button({
                Name = "Load Config",
                Callback = function()
                    if ConfigText and ConfigText ~= "" then
                        local success = pcall(function()
                            Library:LoadConfig(readfile(Library.Directory .. "/configs/" .. ConfigText .. ".cfg"))
                            Library:UpdateConfigList()
                        end)

                        if success then
                            Notifications:Create({Name = "Loaded: " .. ConfigText, LifeTime = 3})
                        else
                            Notifications:Create({Name = "Failed to load config!", LifeTime = 3})
                        end
                    else
                        Notifications:Create({Name = "Select a config first!", LifeTime = 3})
                    end
                end
            })

            ConfigSection:Button({
                Name = "Delete Config",
                Callback = function()
                    if ConfigText and ConfigText ~= "" then
                        pcall(function()
                            delfile(Library.Directory .. "/configs/" .. ConfigText .. ".cfg")
                            Library:UpdateConfigList()
                            Notifications:Create({Name = "Deleted: " .. ConfigText, LifeTime = 3})
                        end)
                    else
                        Notifications:Create({Name = "Select a config first!", LifeTime = 3})
                    end
                end
            })

            -- Menu settings
            local MenuSection = Tab:Section({Name = "Menu", Side = "Left"})

            local MenuBindLabel = MenuSection:Label({Name = "Menu Keybind"})
            MenuBindLabel:Keybind({
                Name = "Menu Bind",
                ShowInList = false,
                Key = Enum.KeyCode.Insert,
                Mode = "Toggle",
                Default = true,
                Callback = function(active)
                    if Library.Initialized then
                        window.ToggleMenu(active)
                    end
                end
            })

            -- UI Settings section
            local UISection = Tab:Section({Name = "UI Settings", Side = "Right"})

            UISection:Toggle({
                Name = "Watermark",
                Flag = "show_watermark",
                Default = false,
                Callback = function(bool)
                    window.ToggleWatermark(bool)
                end
            })

            UISection:Toggle({
                Name = "Keybind List",
                Flag = "show_keybinds",
                Default = false,
                Callback = function(bool)
                    window.ToggleKeybindList(bool)
                end
            })

            UISection:Textbox({
                Name = "Window Title",
                Default = window.Name or "Nebula Premium",
                PlaceHolder = "Enter title...",
                Callback = function(text)
                    window.ChangeTitle(text)
                end
            })

            UISection:Textbox({
                Name = "Watermark Text",
                Default = (window.Name or "Nebula Premium") .. " | v1.0",
                PlaceHolder = "Enter watermark...",
                Callback = function(text)
                    window.ChangeWatermarkTitle(text)
                end
            })

            UISection:Dropdown({
                Name = "Animation Style",
                Options = {"Quint", "Quad", "Linear", "Sine", "Back", "Bounce", "Elastic"},
                Default = "Quint",
                Flag = "anim_style",
                Callback = function(option)
                    if option and Enum.EasingStyle[option] then
                        Library.EasingStyle = Enum.EasingStyle[option]
                    end
                end
            })

            UISection:Slider({
                Name = "Animation Speed",
                Min = 0.1,
                Max = 1,
                Default = 0.25,
                Decimal = 0.05,
                Suffix = "s",
                Flag = "anim_speed",
                Callback = function(value)
                    Library.TweeningSpeed = value
                end
            })

            -- Theme section
            local ThemeSection = Tab:Section({Name = "Theme Colors", Side = "Right"})

            local themeColors = {
                {"Accent", "accent"},
                {"Background", "background"},
                {"Outline", "outline"},
                {"Inline", "inline"},
                {"Gradient", "gradient"},
                {"Text", "text_color"}
            }

            for _, themeData in ipairs(themeColors) do
                ThemeSection:Label({Name = themeData[1]}):Colorpicker({
                    Flag = "theme_" .. themeData[2],
                    Color = themes.preset[themeData[2]],
                    Callback = function(color, alpha)
                        if color then
                            Library:RefreshTheme(themeData[2], color)

                            -- Update gradients
                            for _, grad in ipairs(themes.gradients.Selected) do
                                pcall(function()
                                    grad.Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
                                end)
                            end

                            for _, grad in ipairs(themes.gradients.Deselected) do
                                pcall(function()
                                    grad.Color = rgbseq{rgbkey(0, themes.preset.gradient), rgbkey(1, themes.preset.background)}
                                end)
                            end
                        end
                    end
                })
            end
        end
    --

-- Notifications System
Library.Notifications.Create = function(self, properties)
    local Cfg = {
        Name = properties.Name or "Notification",
        LifeTime = properties.LifeTime or 3,
        Items = {}
    }

    local Items = Cfg.Items

    -- Create notification frame
    Items.Notification = Library:Create("Frame", {
        Parent = Library.Items,
        Name = "\0",
        Position = dim2(1, 10, 1, -60 - (#self.Notifs * 40)),
        Size = dim2(0, 0, 0, 32),
        AutomaticSize = Enum.AutomaticSize.X,
        BorderSizePixel = 0,
        BackgroundColor3 = themes.preset.shadow,
        ZIndex = 200
    })
    Library:Themify(Items.Notification, "shadow", "BackgroundColor3")

    Items.NotifOuter = Library:Create("Frame", {
        Parent = Items.Notification,
        Name = "\0",
        Position = dim2(0, 1, 0, 1),
        Size = dim2(1, -2, 1, -2),
        BorderSizePixel = 0,
        AutomaticSize = Enum.AutomaticSize.X,
        BackgroundColor3 = themes.preset.border_dark,
        ZIndex = 200
    })
    Library:Themify(Items.NotifOuter, "border_dark", "BackgroundColor3")

    Items.NotifInner = Library:Create("Frame", {
        Parent = Items.NotifOuter,
        Name = "\0",
        Position = dim2(0, 1, 0, 1),
        Size = dim2(1, -2, 1, -2),
        BorderSizePixel = 0,
        AutomaticSize = Enum.AutomaticSize.X,
        BackgroundColor3 = themes.preset.outline,
        ZIndex = 200
    })
    Library:Themify(Items.NotifInner, "outline", "BackgroundColor3")

    Items.Accent = Library:Create("Frame", {
        Parent = Items.NotifInner,
        Name = "\0",
        Position = dim2(0, 1, 0, 1),
        Size = dim2(1, -2, 0, 2),
        BorderSizePixel = 0,
        BackgroundColor3 = themes.preset.accent,
        ZIndex = 201
    })
    Library:Themify(Items.Accent, "accent", "BackgroundColor3")

    Library:Create("UIGradient", {
        Rotation = 90,
        Parent = Items.Accent,
        Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(140, 140, 140))}
    })

    Items.Separator = Library:Create("Frame", {
        Parent = Items.NotifInner,
        Name = "\0",
        Position = dim2(0, 0, 0, 3),
        Size = dim2(1, 0, 0, 1),
        BorderSizePixel = 0,
        BackgroundColor3 = themes.preset.outline,
        ZIndex = 201
    })
    Library:Themify(Items.Separator, "outline", "BackgroundColor3")

    Items.Content = Library:Create("Frame", {
        Parent = Items.NotifInner,
        Name = "\0",
        Position = dim2(0, 1, 0, 4),
        Size = dim2(1, -2, 1, -5),
        BorderSizePixel = 0,
        AutomaticSize = Enum.AutomaticSize.X,
        BackgroundColor3 = rgb(255, 255, 255),
        ZIndex = 200
    })

    local contentGrad = Library:Create("UIGradient", {
        Rotation = 90,
        Parent = Items.Content,
        Color = rgbseq{rgbkey(0, themes.preset.inline), rgbkey(1, themes.preset.gradient)}
    })
    Library:SaveGradient(contentGrad, "Selected")

    Items.Text = Library:Create("TextLabel", {
        FontFace = Library.Font,
        TextColor3 = themes.preset.text_color,
        BorderSizePixel = 0,
        Text = Cfg.Name,
        Parent = Items.Content,
        Name = "\0",
        BackgroundTransparency = 1,
        Position = dim2(0, 0, 0, 0),
        Size = dim2(1, 0, 1, 0),
        AutomaticSize = Enum.AutomaticSize.X,
        TextSize = 12,
        BackgroundColor3 = rgb(255, 255, 255),
        ZIndex = 201
    })
    Library:Themify(Items.Text, "text_color", "TextColor3")

    Library:Create("UIStroke", {
        Parent = Items.Text,
        LineJoinMode = Enum.LineJoinMode.Miter
    })

    Library:Create("UIPadding", {
        PaddingTop = dim(0, 2),
        PaddingBottom = dim(0, 2),
        PaddingLeft = dim(0, 10),
        PaddingRight = dim(0, 10),
        Parent = Items.Text
    })

    -- Add to list
    table.insert(self.Notifs, Cfg)

    -- Animate in
    task.defer(function()
        task.wait()
        local targetX = -(Items.Notification.AbsoluteSize.X + 15)
        Library:Tween(Items.Notification, {Position = dim2(1, targetX, Items.Notification.Position.Y.Scale, Items.Notification.Position.Y.Offset)})
    end)

    -- Auto remove
    task.delay(Cfg.LifeTime, function()
        -- Animate out
        local tweenOut = Library:Tween(Items.Notification, {
            Position = dim2(1, 10, Items.Notification.Position.Y.Scale, Items.Notification.Position.Y.Offset)
        })

        if tweenOut then
            tweenOut.Completed:Wait()
        end

        -- Remove from list
        local idx = table.find(self.Notifs, Cfg)
        if idx then
            table.remove(self.Notifs, idx)
        end

        Items.Notification:Destroy()

        -- Reposition remaining notifications
        for i, notif in ipairs(self.Notifs) do
            if notif.Items.Notification then
                Library:Tween(notif.Items.Notification, {
                    Position = dim2(
                        notif.Items.Notification.Position.X.Scale,
                        notif.Items.Notification.Position.X.Offset,
                        1,
                        -60 - ((i - 1) * 40)
                    )
                })
            end
        end
    end)

    return Cfg
end

-- Return library
return Library, Library.Notifications, themes
